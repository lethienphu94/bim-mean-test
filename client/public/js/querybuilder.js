$.extendext=function(){var e,t,r,i,o,n,l=arguments[0]||{},s=1,a=arguments.length,u=!1,p="default";for("boolean"==typeof l&&(u=l,l=arguments[s++]||{}),"string"==typeof l&&("concat"!==(p=l.toLowerCase())&&"replace"!==p&&"extend"!==p&&(p="default"),l=arguments[s++]||{}),"object"==typeof l||$.isFunction(l)||(l={}),s===a&&(l=this,s--);s<a;s++)if(null!==(e=arguments[s]))if($.isArray(e)&&"default"!==p)switch(n=l&&$.isArray(l)?l:[],p){case"concat":l=n.concat($.extend(u,[],e));break;case"replace":l=$.extend(u,[],e);break;case"extend":e.forEach(function(e,t){if("object"==typeof e){var r=$.isArray(e)?[]:{};n[t]=$.extendext(u,p,n[t]||r,e)}else-1===n.indexOf(e)&&n.push(e)}),l=n}else for(t in e)r=l[t],l!==(i=e[t])&&(u&&i&&($.isPlainObject(i)||(o=$.isArray(i)))?(o?(o=!1,n=r&&$.isArray(r)?r:[]):n=r&&$.isPlainObject(r)?r:{},l[t]=$.extendext(u,p,n,i)):void 0!==i&&(l[t]=i));return l};var _globals,doT={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,log:!0};doT.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},r=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(r,function(e){return t[e]||e}):""}},_globals=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define("doT",function(){return doT}):_globals.doT=doT;var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(e,t,r){return("string"==typeof t?t:t.toString()).replace(e.define||skip,function(t,i,o,n){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in r||(":"===o?(e.defineParams&&n.replace(e.defineParams,function(e,t,o){r[i]={arg:t,text:o}}),i in r||(r[i]=n)):new Function("def","def['"+i+"']="+n)(r)),""}).replace(e.use||skip,function(t,i){e.useParams&&(i=i.replace(e.useParams,function(e,t,i,o){if(r[i]&&r[i].arg&&o){var n=(i+":"+o).replace(/'|\\/g,"_");return r.__exp=r.__exp||{},r.__exp[n]=r[i].text.replace(new RegExp("(^|[^\\w$])"+r[i].arg+"([^\\w$])","g"),"$1"+o+"$2"),t+"def.__exp['"+n+"']"}}));var o=new Function("def","return "+i)(r);return o?resolveDefs(e,o,r):o})}function unescape(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}doT.template=function(e,t,r){var i,o,n=(t=t||doT.templateSettings).append?startend.append:startend.split,l=0,s=t.use||t.define?resolveDefs(t,e,r||{}):e;s=("var out='"+(t.strip?s.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):s).replace(/'|\\/g,"\\$&").replace(t.interpolate||skip,function(e,t){return n.start+unescape(t)+n.end}).replace(t.encode||skip,function(e,t){return i=!0,n.startencode+unescape(t)+n.end}).replace(t.conditional||skip,function(e,t,r){return t?r?"';}else if("+unescape(r)+"){out+='":"';}else{out+='":r?"';if("+unescape(r)+"){out+='":"';}out+='"}).replace(t.iterate||skip,function(e,t,r,i){return t?(l+=1,o=i||"i"+l,t=unescape(t),"';var arr"+l+"="+t+";if(arr"+l+"){var "+r+","+o+"=-1,l"+l+"=arr"+l+".length-1;while("+o+"<l"+l+"){"+r+"=arr"+l+"["+o+"+=1];out+='"):"';} } out+='"}).replace(t.evaluate||skip,function(e,t){return"';"+unescape(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),i&&(t.selfcontained||!_globals||_globals._encodeHTML||(_globals._encodeHTML=doT.encodeHTMLSource(t.doNotSkipEncoded)),s="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(t.doNotSkipEncoded||"")+"));"+s);try{return new Function(t.varname,s)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+s),e}},doT.compile=function(e,t){return doT.template(e,null,t)};var QueryBuilder=function(e,t){this.init(e,t)};$.extend(QueryBuilder.prototype,{change:function(e,t){var r=new $.Event(this.tojQueryEvent(e,!0),{builder:this,value:t});return this.$el.triggerHandler(r,Array.prototype.slice.call(arguments,2)),r.value},trigger:function(e){var t=new $.Event(this.tojQueryEvent(e),{builder:this});return this.$el.triggerHandler(t,Array.prototype.slice.call(arguments,1)),t},on:function(e,t){return this.$el.on(this.tojQueryEvent(e),t),this},off:function(e,t){return this.$el.off(this.tojQueryEvent(e),t),this},once:function(e,t){return this.$el.one(this.tojQueryEvent(e),t),this},tojQueryEvent:function(e,t){return e.split(" ").map(function(e){return e+".queryBuilder"+(t?".filter":"")}).join(" ")}}),QueryBuilder.plugins={},QueryBuilder.defaults=function(e){if("object"!=typeof e)return"string"==typeof e?"object"==typeof QueryBuilder.DEFAULTS[e]?$.extend(!0,{},QueryBuilder.DEFAULTS[e]):QueryBuilder.DEFAULTS[e]:$.extend(!0,{},QueryBuilder.DEFAULTS);$.extendext(!0,"replace",QueryBuilder.DEFAULTS,e)},QueryBuilder.define=function(e,t,r){QueryBuilder.plugins[e]={fct:t,def:r||{}}},QueryBuilder.extend=function(e){$.extend(QueryBuilder.prototype,e)},QueryBuilder.prototype.initPlugins=function(){if(this.plugins){if($.isArray(this.plugins)){var e={};this.plugins.forEach(function(t){e[t]=null}),this.plugins=e}Object.keys(this.plugins).forEach(function(e){e in QueryBuilder.plugins?(this.plugins[e]=$.extend(!0,{},QueryBuilder.plugins[e].def,this.plugins[e]||{}),QueryBuilder.plugins[e].fct.call(this,this.plugins[e])):Utils.error("Config",'Unable to find plugin "{0}"',e)},this)}},QueryBuilder.types={string:"string",integer:"number",double:"number",date:"datetime",time:"datetime",datetime:"datetime",boolean:"boolean"},QueryBuilder.inputs=["text","textarea","radio","checkbox","select"],QueryBuilder.modifiable_options=["display_errors","allow_groups","allow_empty","default_condition","default_filter"];var Selectors=QueryBuilder.selectors={group_container:".rules-group-container",rule_container:".rule-container",filter_container:".rule-filter-container",operator_container:".rule-operator-container",value_container:".rule-value-container",error_container:".error-container",condition_container:".rules-group-header .group-conditions",rule_header:".rule-header",group_header:".rules-group-header",group_actions:".group-actions",rule_actions:".rule-actions",rules_list:".rules-group-body>.rules-list",group_condition:".rules-group-header [name$=_cond]",rule_filter:".rule-filter-container [name$=_filter]",rule_operator:".rule-operator-container [name$=_operator]",rule_value:".rule-value-container [name*=_value_]",add_rule:"[data-add=rule]",delete_rule:"[data-delete=rule]",add_group:"[data-add=group]",delete_group:"[data-delete=group]"};function Model(e){if(!(this instanceof Model))return Model.getModel(e);this.root=null,this.$=$(this)}QueryBuilder.templates={},QueryBuilder.regional={},QueryBuilder.OPERATORS={equal:{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},not_equal:{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},in:{type:"in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},not_in:{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},less:{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},less_or_equal:{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater:{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater_or_equal:{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},between:{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},not_between:{type:"not_between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},begins_with:{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_begins_with:{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},contains:{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},not_contains:{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},ends_with:{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_ends_with:{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},is_empty:{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_not_empty:{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_null:{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},is_not_null:{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},compare:{type:"compare",nb_inputs:3,multiple:!0,apply_to:["number","datetime"]}},QueryBuilder.DEFAULTS={filters:[],plugins:[],sort_filters:!1,display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",display_empty_filter:!0,default_filter:null,optgroups:{},default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},default_group_flags:{condition_readonly:!1,no_add_rule:!1,no_add_group:!1,no_delete:!1},templates:{group:null,rule:null,filterSelect:null,operatorSelect:null},lang_code:"en",lang:{},operators:["equal","not_equal","in","not_in","less","less_or_equal","greater","greater_or_equal","between","not_between","begins_with","not_begins_with","contains","not_contains","ends_with","not_ends_with","is_empty","is_not_empty","is_null","is_not_null","compare"],icons:{add_group:"glyphicon glyphicon-plus-sign",add_rule:"glyphicon glyphicon-plus",remove_group:"glyphicon glyphicon-remove",remove_rule:"glyphicon glyphicon-remove",error:"glyphicon glyphicon-warning-sign"}},QueryBuilder.prototype.init=function(e,t){e[0].queryBuilder=this,this.$el=e,this.settings=$.extendext(!0,"replace",{},QueryBuilder.DEFAULTS,t),this.model=new Model,this.status={group_id:0,rule_id:0,generated_id:!1,has_optgroup:!1,has_operator_oprgroup:!1,id:null},!1===this.settings.allow_groups?this.settings.allow_groups=0:!0===this.settings.allow_groups&&(this.settings.allow_groups=-1),this.filters=this.settings.filters,this.icons=this.settings.icons,this.operators=this.settings.operators,this.templates=this.settings.templates,this.plugins=this.settings.plugins,void 0===QueryBuilder.regional.en&&Utils.error("Config",'"i18n/en.js" not loaded.'),this.lang=$.extendext(!0,"replace",{},QueryBuilder.regional.en,QueryBuilder.regional[this.settings.lang_code],this.settings.lang),Object.keys(this.templates).forEach(function(e){this.templates[e]||(this.templates[e]=QueryBuilder.templates[e]),"string"==typeof this.templates[e]&&(this.templates[e]=doT.template(this.templates[e]))},this),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.filters=this.checkFilters(this.filters),this.operators=this.checkOperators(this.operators),this.bindEvents(),this.initPlugins(),this.trigger("afterInit"),t.rules?(this.setRules(t.rules),delete this.settings.rules):this.setRoot(!0)},QueryBuilder.prototype.checkFilters=function(e){var t=[];if(e&&0!==e.length||Utils.error("Config","Missing filters list"),e.forEach(function(e,r){switch(e.id||Utils.error("Config","Missing filter {0} id",r),-1!=t.indexOf(e.id)&&Utils.error("Config",'Filter "{0}" already defined',e.id),t.push(e.id),e.type?QueryBuilder.types[e.type]||Utils.error("Config",'Invalid type "{0}"',e.type):e.type="string",e.input?"function"!=typeof e.input&&-1==QueryBuilder.inputs.indexOf(e.input)&&Utils.error("Config",'Invalid input "{0}"',e.input):e.input="text",e.operators&&e.operators.forEach(function(e){"string"!=typeof e&&Utils.error("Config","Filter operators must be global operators types (string)")}),e.field||(e.field=e.id),e.label||(e.label=e.field),e.optgroup?(this.status.has_optgroup=!0,this.settings.optgroups[e.optgroup]||(this.settings.optgroups[e.optgroup]=e.optgroup)):e.optgroup=null,e.input){case"radio":case"checkbox":(!e.values||e.values.length<1)&&Utils.error("Config",'Missing filter "{0}" values',e.id);break;case"select":e.placeholder&&(void 0===e.placeholder_value&&(e.placeholder_value=-1),Utils.iterateOptions(e.values,function(t){t==e.placeholder_value&&Utils.error("Config",'Placeholder of filter "{0}" overlaps with one of its values',e.id)}))}},this),this.settings.sort_filters)if("function"==typeof this.settings.sort_filters)e.sort(this.settings.sort_filters);else{var r=this;e.sort(function(e,t){return r.translateLabel(e.label).localeCompare(r.translateLabel(t.label))})}return this.status.has_optgroup&&(e=Utils.groupSort(e,"optgroup")),e},QueryBuilder.prototype.checkOperators=function(e){var t=[];return e.forEach(function(r,i){"string"==typeof r?(QueryBuilder.OPERATORS[r]||Utils.error("Config",'Unknown operator "{0}"',r),e[i]=r=$.extendext(!0,"replace",{},QueryBuilder.OPERATORS[r])):(r.type||Utils.error("Config",'Missing "type" for operator {0}',i),QueryBuilder.OPERATORS[r.type]&&(e[i]=r=$.extendext(!0,"replace",{},QueryBuilder.OPERATORS[r.type],r)),void 0!==r.nb_inputs&&void 0!==r.apply_to||Utils.error("Config",'Missing "nb_inputs" and/or "apply_to" for operator "{0}"',r.type)),-1!=t.indexOf(r.type)&&Utils.error("Config",'Operator "{0}" already defined',r.type),t.push(r.type),r.optgroup?(this.status.has_operator_optgroup=!0,this.settings.optgroups[r.optgroup]||(this.settings.optgroups[r.optgroup]=r.optgroup)):r.optgroup=null},this),this.status.has_operator_optgroup&&(e=Utils.groupSort(e,"optgroup")),e},QueryBuilder.prototype.bindEvents=function(){var e=this;this.$el.on("change.queryBuilder",Selectors.group_condition,function(){$(this).is(":checked")&&(Model($(this).closest(Selectors.group_container)).condition=$(this).val())}),this.$el.on("change.queryBuilder",Selectors.rule_filter,function(){Model($(this).closest(Selectors.rule_container)).filter=e.getFilterById($(this).val())}),this.$el.on("change.queryBuilder",Selectors.rule_operator,function(){Model($(this).closest(Selectors.rule_container)).operator=e.getOperatorByType($(this).val())}),this.$el.on("click.queryBuilder",Selectors.add_rule,function(){var t=$(this).closest(Selectors.group_container);e.addRule(Model(t))}),this.$el.on("click.queryBuilder",Selectors.delete_rule,function(){var t=$(this).closest(Selectors.rule_container);e.deleteRule(Model(t))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder",Selectors.add_group,function(){var t=$(this).closest(Selectors.group_container);e.addGroup(Model(t))}),this.$el.on("click.queryBuilder",Selectors.delete_group,function(){var t=$(this).closest(Selectors.group_container);e.deleteGroup(Model(t))})),this.model.on({drop:function(t,r){r.$el.remove(),e.refreshGroupsConditions()},add:function(t,r,i){0===i?r.$el.prependTo(r.parent.$el.find(">"+Selectors.rules_list)):r.$el.insertAfter(r.parent.rules[i-1].$el),e.refreshGroupsConditions()},move:function(t,r,i,o){r.$el.detach(),0===o?r.$el.prependTo(i.$el.find(">"+Selectors.rules_list)):r.$el.insertAfter(i.rules[o-1].$el),e.refreshGroupsConditions()},update:function(t,r,i,o,n){if(r instanceof Rule)switch(i){case"error":e.displayError(r);break;case"flags":e.applyRuleFlags(r);break;case"filter":e.updateRuleFilter(r,n);break;case"operator":e.updateRuleOperator(r,n);break;case"value":e.updateRuleValue(r)}else switch(i){case"error":e.displayError(r);break;case"flags":e.applyGroupFlags(r);break;case"condition":e.updateGroupCondition(r)}}})},QueryBuilder.prototype.setRoot=function(e,t,r){e=void 0===e||!0===e;var i=this.nextGroupId(),o=$(this.getGroupTemplate(i,1));return this.$el.append(o),this.model.root=new Group(null,o),this.model.root.model=this.model,this.model.root.data=t,this.model.root.__.flags=$.extend({},this.settings.default_group_flags,r),this.trigger("afterAddGroup",this.model.root),this.model.root.condition=this.settings.default_condition,e&&this.addRule(this.model.root),this.model.root},QueryBuilder.prototype.addGroup=function(e,t,r,i){t=void 0===t||!0===t;var o=e.level+1;if(this.trigger("beforeAddGroup",e,t,o).isDefaultPrevented())return null;var n=this.nextGroupId(),l=$(this.getGroupTemplate(n,o)),s=e.addGroup(l);return s.data=r,s.__.flags=$.extend({},this.settings.default_group_flags,i),this.trigger("afterAddGroup",s),s.condition=this.settings.default_condition,t&&this.addRule(s),s},QueryBuilder.prototype.deleteGroup=function(e){if(e.isRoot())return!1;if(this.trigger("beforeDeleteGroup",e).isDefaultPrevented())return!1;var t=!0;return e.each("reverse",function(e){t&=this.deleteRule(e)},function(e){t&=this.deleteGroup(e)},this),t&&(e.drop(),this.trigger("afterDeleteGroup")),t},QueryBuilder.prototype.updateGroupCondition=function(e){e.$el.find(">"+Selectors.group_condition).each(function(){var t=$(this);t.prop("checked",t.val()===e.condition),t.parent().toggleClass("active",t.val()===e.condition)}),this.trigger("afterUpdateGroupCondition",e)},QueryBuilder.prototype.refreshGroupsConditions=function(){!function e(t){(!t.flags||t.flags&&!t.flags.condition_readonly)&&t.$el.find(">"+Selectors.group_condition).prop("disabled",t.rules.length<=1).parent().toggleClass("disabled",t.rules.length<=1),t.each(function(e){},function(t){e(t)},this)}(this.model.root)},QueryBuilder.prototype.addRule=function(e,t,r){if(this.trigger("beforeAddRule",e).isDefaultPrevented())return null;var i=this.nextRuleId(),o=$(this.getRuleTemplate(i)),n=e.addRule(o);return void 0!==t&&(n.data=t),n.__.flags=$.extend({},this.settings.default_rule_flags,r),this.trigger("afterAddRule",n),this.createRuleFilters(n),!this.settings.default_filter&&this.settings.display_empty_filter||(n.filter=this.change("getDefaultFilter",this.getFilterById(this.settings.default_filter||this.filters[0].id),n)),n},QueryBuilder.prototype.deleteRule=function(e){return!e.flags.no_delete&&(!this.trigger("beforeDeleteRule",e).isDefaultPrevented()&&(e.drop(),this.trigger("afterDeleteRule"),!0))},QueryBuilder.prototype.createRuleFilters=function(e){var t=this.change("getRuleFilters",this.filters,e),r=$(this.getRuleFilterSelect(e,t));e.$el.find(Selectors.filter_container).html(r),this.trigger("afterCreateRuleFilters",e)},QueryBuilder.prototype.createRuleOperators=function(e){var t=e.$el.find(Selectors.operator_container).empty();if(e.filter){var r=this.getOperators(e.filter),i=$(this.getRuleOperatorSelect(e,r));t.html(i),e.__.operator=r[0],this.trigger("afterCreateRuleOperators",e,r)}},QueryBuilder.prototype.createRuleInput=function(e){var t=e.$el.find(Selectors.value_container).empty();if(e.__.value=void 0,e.filter&&e.operator&&0!==e.operator.nb_inputs){for(var r=this,i=$(),o=e.filter,n=0;n<e.operator.nb_inputs;n++){var l=$(this.getRuleInput(e,n));n>0&&t.append(this.settings.inputs_separator),t.append(l),i=i.add(l),3===e.operator.nb_inputs&&(n=3)}t.show(),i.on("change "+(o.input_event||""),function(){this._updating_input||(e._updating_value=!0,e.value=r.getRuleInputValue(e),e._updating_value=!1)}),o.plugin&&i[o.plugin](o.plugin_config||{}),this.trigger("afterCreateRuleInput",e),void 0!==o.default_value?e.value=o.default_value:(e._updating_value=!0,e.value=r.getRuleInputValue(e),e._updating_value=!1)}},QueryBuilder.prototype.updateRuleFilter=function(e,t){this.createRuleOperators(e),this.createRuleInput(e),e.$el.find(Selectors.rule_filter).val(e.filter?e.filter.id:"-1"),t&&e.filter&&t.id!==e.filter.id&&(e.data=void 0),this.trigger("afterUpdateRuleFilter",e)},QueryBuilder.prototype.updateRuleOperator=function(e,t){var r=e.$el.find(Selectors.value_container);e.operator&&0!==e.operator.nb_inputs?(r.show(),!r.is(":empty")&&t&&e.operator.nb_inputs===t.nb_inputs||this.createRuleInput(e)):(r.hide(),e.__.value=void 0),e.operator&&e.$el.find(Selectors.rule_operator).val(e.operator.type),this.trigger("afterUpdateRuleOperator",e),this.updateRuleValue(e)},QueryBuilder.prototype.updateRuleValue=function(e){e._updating_value||this.setRuleInputValue(e,e.value),this.trigger("afterUpdateRuleValue",e)},QueryBuilder.prototype.applyRuleFlags=function(e){var t=e.flags;t.filter_readonly&&e.$el.find(Selectors.rule_filter).prop("disabled",!0),t.operator_readonly&&e.$el.find(Selectors.rule_operator).prop("disabled",!0),t.value_readonly&&e.$el.find(Selectors.rule_value).prop("disabled",!0),t.no_delete&&e.$el.find(Selectors.delete_rule).remove(),this.trigger("afterApplyRuleFlags",e)},QueryBuilder.prototype.applyGroupFlags=function(e){var t=e.flags;t.condition_readonly&&e.$el.find(">"+Selectors.group_condition).prop("disabled",!0).parent().addClass("readonly"),t.no_add_rule&&e.$el.find(Selectors.add_rule).remove(),t.no_add_group&&e.$el.find(Selectors.add_group).remove(),t.no_delete&&e.$el.find(Selectors.delete_group).remove(),this.trigger("afterApplyGroupFlags",e)},QueryBuilder.prototype.clearErrors=function(e){(e=e||this.model.root)&&(e.error=null,e instanceof Group&&e.each(function(e){e.error=null},function(e){this.clearErrors(e)},this))},QueryBuilder.prototype.displayError=function(e){if(this.settings.display_errors)if(null===e.error)e.$el.removeClass("has-error");else{var t=this.lang.errors[e.error[0]]||e.error[0];t=Utils.fmt(t,e.error.slice(1)),t=this.change("displayError",t,e.error,e),e.$el.addClass("has-error").find(Selectors.error_container).eq(0).attr("title",t)}},QueryBuilder.prototype.triggerValidationError=function(e,t,r){$.isArray(t)||(t=[t]),this.trigger("validationError",e,t,r).isDefaultPrevented()||(e.error=t)},QueryBuilder.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},QueryBuilder.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.addRule(this.model.root),this.trigger("afterReset")},QueryBuilder.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear")},QueryBuilder.prototype.setOptions=function(e){$.each(e,function(e,t){-1!==QueryBuilder.modifiable_options.indexOf(e)&&(this.settings[e]=t)}.bind(this))},QueryBuilder.prototype.getModel=function(e){return e?Model(e):this.model.root},QueryBuilder.prototype.validate=function(){this.clearErrors();var e=this,t=function t(r){var i=0,o=0;return r.each(function(t){if(!t.filter)return e.triggerValidationError(t,"no_filter",null),void o++;if(!t.operator)return e.triggerValidationError(t,"no_operator",null),void o++;if(0!==t.operator.nb_inputs){var r=e.validateValue(t,t.value);if(!0!==r)return e.triggerValidationError(t,r,t.value),void o++}i++},function(e){t(e)?i++:o++}),!(o>0)&&(!!(0!==i||e.settings.allow_empty&&r.isRoot())||(e.triggerValidationError(r,"empty_group",null),!1))}(this.model.root);return this.change("validate",t)},QueryBuilder.prototype.getRules=function(e){e=$.extend({get_flags:!1,allow_invalid:!1},e);var t=this.validate();if(!t&&!e.allow_invalid)return null;var r=this,i=function t(i){var o={condition:i.condition,rules:[]};if(i.data&&(o.data=$.extendext(!0,"replace",{},i.data)),e.get_flags){var n=r.getGroupFlags(i.flags,"all"===e.get_flags);$.isEmptyObject(n)||(o.flags=n)}return i.each(function(t){var i=null;t.operator&&0===t.operator.nb_inputs||(i=t.value);var n={id:t.filter?t.filter.id:null,field:t.filter?t.filter.field:null,type:t.filter?t.filter.type:null,input:t.filter?t.filter.input:null,operator:t.operator?t.operator.type:null,value:i};if((t.filter&&t.filter.data||t.data)&&(n.data=$.extendext(!0,"replace",{},t.filter.data,t.data)),e.get_flags){var l=r.getRuleFlags(t.flags,"all"===e.get_flags);$.isEmptyObject(l)||(n.flags=l)}o.rules.push(r.change("ruleToJson",n,t))},function(e){o.rules.push(t(e))},this),r.change("groupToJson",o,i)}(this.model.root);return i.valid=t,this.change("getRules",i)},QueryBuilder.prototype.setRules=function(e,t){t=$.extend({allow_invalid:!1},t),$.isArray(e)&&(e={condition:this.settings.default_condition,rules:e}),e&&e.rules&&(0!==e.rules.length||this.settings.allow_empty)||Utils.error("RulesParse","Incorrect data object passed"),this.clear(),this.setRoot(!1,e.data,this.parseGroupFlags(e)),this.applyGroupFlags(this.model.root),e=this.change("setRules",e);var r=this;!function e(i,o){null!==o&&(void 0===i.condition?i.condition=r.settings.default_condition:-1==r.settings.conditions.indexOf(i.condition)&&(Utils.error(!t.allow_invalid,"UndefinedCondition",'Invalid condition "{0}"',i.condition),i.condition=r.settings.default_condition),o.condition=i.condition,i.rules.forEach(function(i){var n;if(void 0!==i.rules)if(-1!==r.settings.allow_groups&&r.settings.allow_groups<o.level)Utils.error(!t.allow_invalid,"RulesParse","No more than {0} groups are allowed",r.settings.allow_groups),r.reset();else{if(null===(n=r.addGroup(o,!1,i.data,r.parseGroupFlags(i))))return;r.applyGroupFlags(n),e(i,n)}else{if(i.empty||(void 0===i.id&&(Utils.error(!t.allow_invalid,"RulesParse","Missing rule field id"),i.empty=!0),void 0===i.operator&&(i.operator="equal")),null===(n=r.addRule(o,i.data,r.parseRuleFlags(i))))return;i.empty||(n.filter=r.getFilterById(i.id,!t.allow_invalid),n.filter&&(n.operator=r.getOperatorByType(i.operator,!t.allow_invalid),n.operator||(n.operator=r.getOperators(n.filter)[0]),n.operator&&0!==n.operator.nb_inputs&&void 0!==i.value&&(n.value=i.value))),r.applyRuleFlags(n),r.change("jsonToRule",n,i)!=n&&Utils.error("RulesParse","Plugin tried to change rule reference")}}),r.change("jsonToGroup",o,i)!=o&&Utils.error("RulesParse","Plugin tried to change group reference"))}(e,this.model.root)},QueryBuilder.prototype.validateValue=function(e,t){var r=e.filter.validation||{},i=!0;return i=r.callback?r.callback.call(this,t,e):this.validateValueInternal(e,t),this.change("validateValue",i,t,e)},QueryBuilder.prototype.validateValueInternal=function(e,t){var r,i=e.filter,o=e.operator,n=i.validation||{},l=!0;1===e.operator.nb_inputs&&(t=[t]);for(var s=0;s<o.nb_inputs;s++){switch(i.input){case"radio":if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["radio_empty"]);break}break;case"checkbox":if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["checkbox_empty"]);break}if(!o.multiple&&t[s].length>1){l=["operator_not_multiple",o.type];break}break;case"select":if(void 0===t[s]||0===t[s].length||i.placeholder&&t[s]==i.placeholder_value){n.allow_empty_value||(l=["select_empty"]);break}if(i.multiple&&!o.multiple&&t[s].length>1){l=["operator_not_multiple",o.type];break}break;default:switch(QueryBuilder.types[i.type]){case"string":if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["string_empty"]);break}if(void 0!==n.min&&t[s].length<parseInt(n.min)){l=[this.getValidationMessage(n,"min","string_exceed_min_length"),n.min];break}if(void 0!==n.max&&t[s].length>parseInt(n.max)){l=[this.getValidationMessage(n,"max","string_exceed_max_length"),n.max];break}if(n.format&&("string"==typeof n.format&&(n.format=new RegExp(n.format)),!n.format.test(t[s]))){l=[this.getValidationMessage(n,"format","string_invalid_format"),n.format];break}break;case"number":if("compare"===o.type)break;if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["number_nan"]);break}if(isNaN(t[s])){l=["number_nan"];break}if("integer"==i.type){if(parseInt(t[s])!=t[s]){l=["number_not_integer"];break}}else if(parseFloat(t[s])!=t[s]){l=["number_not_double"];break}if(void 0!==n.min&&t[s]<parseFloat(n.min)){l=[this.getValidationMessage(n,"min","number_exceed_min"),n.min];break}if(void 0!==n.max&&t[s]>parseFloat(n.max)){l=[this.getValidationMessage(n,"max","number_exceed_max"),n.max];break}if(void 0!==n.step&&"any"!==n.step){var a=(t[s]/n.step).toPrecision(14);if(parseInt(a)!=a){l=[this.getValidationMessage(n,"step","number_wrong_step"),n.step];break}}break;case"datetime":if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["datetime_empty"]);break}if(n.format){"moment"in window||Utils.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com");var u=moment(t[s],n.format);if(!u.isValid()){l=[this.getValidationMessage(n,"format","datetime_invalid"),n.format];break}if(n.min&&u<moment(n.min,n.format)){l=[this.getValidationMessage(n,"min","datetime_exceed_min"),n.min];break}if(n.max&&u>moment(n.max,n.format)){l=[this.getValidationMessage(n,"max","datetime_exceed_max"),n.max];break}}break;case"boolean":if(void 0===t[s]||0===t[s].length){n.allow_empty_value||(l=["boolean_not_valid"]);break}if("true"!==(r=(""+t[s]).trim().toLowerCase())&&"false"!==r&&"1"!==r&&"0"!==r&&1!==t[s]&&0!==t[s]){l=["boolean_not_valid"];break}}}if(!0!==l)break}return l},QueryBuilder.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},QueryBuilder.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},QueryBuilder.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));for(var t=[],r=0,i=this.operators.length;r<i;r++){if(e.operators){if(-1==e.operators.indexOf(this.operators[r].type))continue}else if(-1==this.operators[r].apply_to.indexOf(QueryBuilder.types[e.type]))continue;t.push(this.operators[r])}return e.operators&&t.sort(function(t,r){return e.operators.indexOf(t.type)-e.operators.indexOf(r.type)}),this.change("getOperators",t,e)},QueryBuilder.prototype.getFilterById=function(e,t){if("-1"==e)return null;for(var r=0,i=this.filters.length;r<i;r++)if(this.filters[r].id==e)return this.filters[r];return Utils.error(!1!==t,"UndefinedFilter",'Undefined filter "{0}"',e),null},QueryBuilder.prototype.getOperatorByType=function(e,t){if("-1"==e)return null;for(var r=0,i=this.operators.length;r<i;r++)if(this.operators[r].type==e)return this.operators[r];return Utils.error(!1!==t,"UndefinedOperator",'Undefined operator "{0}"',e),null},QueryBuilder.prototype.getRuleInputValue=function(e){var t=e.filter,r=e.operator,i=[];if(t.valueGetter)i=t.valueGetter.call(this,e);else{for(var o=e.$el.find(Selectors.value_container),n=0;n<r.nb_inputs;n++){var l,s=Utils.escapeElementId(e.id+"_value_"+n);switch(t.input){case"radio":i.push(o.find("[name="+s+"]:checked").val());break;case"checkbox":l=[],o.find("[name="+s+"]:checked").each(function(){l.push($(this).val())}),i.push(l);break;case"select":t.multiple?(l=[],o.find("[name="+s+"] option:selected").each(function(){l.push($(this).val())}),i.push(l)):i.push(o.find("[name="+s+"] option:selected").val());break;default:i.push(o.find("[name="+s+"]").val())}}r.multiple&&t.value_separator&&(i=i.map(function(e){return e.split(t.value_separator)})),1===r.nb_inputs&&(i=i[0]),t.valueParser&&(i=t.valueParser.call(this,e,i))}return this.change("getRuleValue",i,e)},QueryBuilder.prototype.setRuleInputValue=function(e,t){var r=e.filter,i=e.operator;if(r&&i){if(this._updating_input=!0,r.valueSetter)r.valueSetter.call(this,e,t);else{var o=e.$el.find(Selectors.value_container);1==i.nb_inputs&&(t=[t]);for(var n=0;n<i.nb_inputs;n++){var l=Utils.escapeElementId(e.id+"_value_"+n);switch(r.input){case"radio":o.find("[name="+l+'][value="'+t[n]+'"]').prop("checked",!0).trigger("change");break;case"checkbox":$.isArray(t[n])||(t[n]=[t[n]]),t[n].forEach(function(e){o.find("[name="+l+'][value="'+e+'"]').prop("checked",!0).trigger("change")});break;default:i.multiple&&r.value_separator&&$.isArray(t[n])&&(t[n]=t[n].join(r.value_separator)),o.find("[name="+l+"]").val(t[n]).trigger("change")}}}this._updating_input=!1}},QueryBuilder.prototype.parseRuleFlags=function(e){var t=$.extend({},this.settings.default_rule_flags);return e.readonly&&$.extend(t,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),e.flags&&$.extend(t,e.flags),this.change("parseRuleFlags",t,e)},QueryBuilder.prototype.getRuleFlags=function(e,t){if(t)return $.extend({},e);var r={};return $.each(this.settings.default_rule_flags,function(t,i){e[t]!==i&&(r[t]=e[t])}),r},QueryBuilder.prototype.parseGroupFlags=function(e){var t=$.extend({},this.settings.default_group_flags);return e.readonly&&$.extend(t,{condition_readonly:!0,no_add_rule:!0,no_add_group:!0,no_delete:!0}),e.flags&&$.extend(t,e.flags),this.change("parseGroupFlags",t,e)},QueryBuilder.prototype.getGroupFlags=function(e,t){if(t)return $.extend({},e);var r={};return $.each(this.settings.default_group_flags,function(t,i){e[t]!==i&&(r[t]=e[t])}),r},QueryBuilder.prototype.translateLabel=function(e){return"object"==typeof e?e[this.settings.lang_code]||e.en:e},QueryBuilder.prototype.getValidationMessage=function(e,t,r){return e.messages&&e.messages[t]||r},QueryBuilder.templates.group='<dl id="{{= it.group_id }}" class="rules-group-container">   <dt class="rules-group-header">     <div class="btn-group pull-right group-actions">       <button type="button" class="btn btn-xs btn-success" data-add="rule">         <i class="{{= it.icons.add_rule }}"></i> {{= it.lang.add_rule }}       </button>       {{? it.settings.allow_groups===-1 || it.settings.allow_groups>=it.level }}         <button type="button" class="btn btn-xs btn-success" data-add="group">           <i class="{{= it.icons.add_group }}"></i> {{= it.lang.add_group }}         </button>       {{?}}       {{? it.level>1 }}         <button type="button" class="btn btn-xs btn-danger" data-delete="group">           <i class="{{= it.icons.remove_group }}"></i> {{= it.lang.delete_group }}         </button>       {{?}}     </div>     <div class="btn-group group-conditions">       {{~ it.conditions: condition }}         <label class="btn btn-xs btn-primary">           <input type="radio" name="{{= it.group_id }}_cond" value="{{= condition }}"> {{= it.lang.conditions[condition] || condition }}         </label>       {{~}}     </div>     {{? it.settings.display_errors }}       <div class="error-container"><i class="{{= it.icons.error }}"></i></div>     {{?}}   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>',QueryBuilder.templates.rule='<li id="{{= it.rule_id }}" class="rule-container">   <div class="rule-header">     <div class="btn-group pull-right rule-actions">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule">         <i class="{{= it.icons.remove_rule }}"></i> {{= it.lang.delete_rule }}       </button>     </div>   </div>   {{? it.settings.display_errors }}     <div class="error-container"><i class="{{= it.icons.error }}"></i></div>   {{?}}   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </li>',QueryBuilder.templates.filterSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.rule.id }}_filter">   {{? it.settings.display_empty_filter }}     <option value="-1">{{= it.settings.select_placeholder }}</option>   {{?}}   {{~ it.filters: filter }}     {{? optgroup !== filter.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = filter.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= filter.id }}">{{= it.translate(filter.label) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',QueryBuilder.templates.operatorSelect='{{? it.operators.length === 1 }} <span> {{= it.lang.operators[it.operators[0].type] || it.operators[0].type }} </span> {{?}} {{ var optgroup = null; }} <select class="form-control {{? it.operators.length === 1 }}hide{{?}}" name="{{= it.rule.id }}_operator">   {{~ it.operators: operator }}     {{? optgroup !== operator.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = operator.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= operator.type }}">{{= it.lang.operators[operator.type] || operator.type }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',QueryBuilder.prototype.getGroupTemplate=function(e,t){var r=this.templates.group({builder:this,group_id:e,level:t,conditions:this.settings.conditions,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getGroupTemplate",r,t)},QueryBuilder.prototype.getRuleTemplate=function(e){var t=this.templates.rule({builder:this,rule_id:e,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getRuleTemplate",t)},QueryBuilder.prototype.getRuleFilterSelect=function(e,t){var r=this.templates.filterSelect({builder:this,rule:e,filters:t,icons:this.icons,lang:this.lang,settings:this.settings,translate:this.translateLabel});return this.change("getRuleFilterSelect",r,e)},QueryBuilder.prototype.getRuleOperatorSelect=function(e,t){var r=this.templates.operatorSelect({builder:this,rule:e,operators:t,icons:this.icons,lang:this.lang,settings:this.settings,translate:this.translateLabel});return this.change("getRuleOperatorSelect",r,e)},QueryBuilder.prototype.getRuleInput=function(e,t){var r=e.filter,i=e.filter.validation||{},o=e.id+"_value_"+t,n=r.vertical?" class=block":"",l="";if("function"==typeof r.input)l=r.input.call(this,e,o);else switch(r.input){case"radio":case"checkbox":Utils.iterateOptions(r.values,function(e,t){l+="<label"+n+'><input type="'+r.input+'" name="'+o+'" value="'+e+'"> '+t+"</label> "});break;case"select":l+='<select class="form-control" name="'+o+'"'+(r.multiple?" multiple":"")+">",r.placeholder&&(l+='<option value="'+r.placeholder_value+'" disabled selected>'+r.placeholder+"</option>"),Utils.iterateOptions(r.values,function(e,t){l+='<option value="'+e+'">'+t+"</option> "}),l+="</select>";break;case"textarea":l+='<textarea class="form-control" name="'+o+'"',r.size&&(l+=' cols="'+r.size+'"'),r.rows&&(l+=' rows="'+r.rows+'"'),void 0!==i.min&&(l+=' minlength="'+i.min+'"'),void 0!==i.max&&(l+=' maxlength="'+i.max+'"'),r.placeholder&&(l+=' placeholder="'+r.placeholder+'"'),l+="></textarea>";break;default:switch(QueryBuilder.types[r.type]){case"number":l+='<input class="form-control" type="number" name="'+o+'"',void 0!==i.step&&(l+=' step="'+i.step+'"'),void 0!==i.min&&(l+=' min="'+i.min+'"'),void 0!==i.max&&(l+=' max="'+i.max+'"'),r.placeholder&&(l+=' placeholder="'+r.placeholder+'"'),r.size&&(l+=' size="'+r.size+'"'),l+=">";break;default:l+='<input class="form-control" type="text" name="'+o+'"',r.placeholder&&(l+=' placeholder="'+r.placeholder+'"'),"string"===r.type&&void 0!==i.min&&(l+=' minlength="'+i.min+'"'),"string"===r.type&&void 0!==i.max&&(l+=' maxlength="'+i.max+'"'),r.size&&(l+=' size="'+r.size+'"'),l+=">"}}return this.change("getRuleInput",l,e,o)},$.extend(Model.prototype,{trigger:function(e){return this.$.triggerHandler(e,Array.prototype.slice.call(arguments,1)),this},on:function(){return this.$.on.apply(this.$,Array.prototype.slice.call(arguments)),this},off:function(){return this.$.off.apply(this.$,Array.prototype.slice.call(arguments)),this},once:function(){return this.$.one.apply(this.$,Array.prototype.slice.call(arguments)),this}}),Model.getModel=function(e){return e?e instanceof Node?e:$(e).data("queryBuilderModel"):null},Model.defineModelProperties=function(e,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this.__[t]},set:function(e){var r=null!==this.__[t]&&"object"==typeof this.__[t]?$.extend({},this.__[t]):this.__[t];this.__[t]=e,null!==this.model&&this.model.trigger("update",this,t,e,r)}})})};var Node=function(e,t){if(!(this instanceof Node))return new Node;Object.defineProperty(this,"__",{value:{}}),t.data("queryBuilderModel",this),this.__.level=1,this.__.error=null,this.__.data=void 0,this.$el=t,this.id=t[0].id,this.model=null,this.parent=e};Model.defineModelProperties(Node,["level","error","data","flags"]),Object.defineProperty(Node.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(e){this.__.parent=e,this.level=null===e?1:e.level+1,this.model=null===e?null:e.model}}),Node.prototype.isRoot=function(){return 1===this.level},Node.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},Node.prototype.drop=function(){var e=this.model;this.isRoot()||this.parent._removeNode(this),null!==e&&e.trigger("drop",this)},Node.prototype.moveAfter=function(e){if(!this.isRoot())return this._move(e.parent,e.getPos()+1),this},Node.prototype.moveAtBegin=function(e){if(!this.isRoot())return void 0===e&&(e=this.parent),this._move(e,0),this},Node.prototype.moveAtEnd=function(e){if(!this.isRoot())return void 0===e&&(e=this.parent),this._move(e,0===e.length()?0:e.length()-1),this},Node.prototype._move=function(e,t){this.parent._removeNode(this),e._appendNode(this,t,!1),null!==this.model&&this.model.trigger("move",this,e,t)};var Group=function(e,t){if(!(this instanceof Group))return new Group(e,t);Node.call(this,e,t),this.rules=[],this.__.condition=null};Group.prototype=Object.create(Node.prototype),Group.prototype.constructor=Group,Model.defineModelProperties(Group,["condition"]),Group.prototype.empty=function(){this.each("reverse",function(e){e.drop()},function(e){e.drop()})},Group.prototype.drop=function(){this.empty(),Node.prototype.drop.call(this)},Group.prototype.length=function(){return this.rules.length},Group.prototype._appendNode=function(e,t,r){return void 0===t&&(t=this.length()),this.rules.splice(t,0,e),e.parent=this,r&&null!==this.model&&this.model.trigger("add",e,t),e},Group.prototype.addGroup=function(e,t){return this._appendNode(new Group(this,e),t,!0)},Group.prototype.addRule=function(e,t){return this._appendNode(new Rule(this,e),t,!0)},Group.prototype._removeNode=function(e){var t=this.getNodePos(e);return-1!==t&&(e.parent=null,this.rules.splice(t,1)),this},Group.prototype.getNodePos=function(e){return this.rules.indexOf(e)},Group.prototype.each=function(e,t,r,i){"function"==typeof e&&(i=r,r=t,t=e,e=!1),i=void 0===i?null:i;for(var o=e?this.rules.length-1:0,n=e?0:this.rules.length-1,l=e?-1:1,s=!1;(e?o>=n:o<=n)&&(this.rules[o]instanceof Group?void 0!==r&&(s=!1===r.call(i,this.rules[o])):s=!1===t.call(i,this.rules[o]),!s);o+=l);return!s},Group.prototype.contains=function(e,t){return-1!==this.getNodePos(e)||!!t&&!this.each(function(e){return!0},function(t){return!t.contains(e,!0)})};var Rule=function(e,t){if(!(this instanceof Rule))return new Rule(e,t);Node.call(this,e,t),this._updating_value=!1,this._updating_input=!1,this.__.filter=null,this.__.operator=null,this.__.flags={},this.__.value=void 0};Rule.prototype=Object.create(Node.prototype),Rule.prototype.constructor=Rule,Model.defineModelProperties(Rule,["filter","operator","value"]),QueryBuilder.Group=Group,QueryBuilder.Rule=Rule;var Utils=QueryBuilder.utils={};function determineMongoOperator(e,t){if(null!==e&&"object"==typeof e){var r=Object.keys(e);return 1===r.length?r[0]:void 0!==e.$gte&&void 0!==e.$lte?"between":void 0!==e.$lt&&void 0!==e.$gt?"not_between":void 0!==e.$regex?"$regex":void 0}return"eq"}function andOr(e){for(var t=Object.keys(e),r=0,i=t.length;r<i;r++)if("$or"==t[r].toLowerCase()||"$and"==t[r].toLowerCase())return t[r]}function moveSortableToTarget(e,t,r){var i,o;(i=t.closest(Selectors.rule_container)).length&&(o="moveAfter"),o||(i=t.closest(Selectors.group_header)).length&&(i=t.closest(Selectors.group_container),o="moveAtBegin"),o||(i=t.closest(Selectors.group_container)).length&&(o="moveAtEnd"),o&&(e[o](Model(i)),r&&e instanceof Rule&&r.setRuleInputValue(e,e.value))}function getStmtConfig(e){var t=e.match(/(question_mark|numbered|named)(?:\((.)\))?/);return t||(t=[null,"question_mark",void 0]),t}Utils.iterateOptions=function(e,t){e&&($.isArray(e)?e.forEach(function(e){$.isPlainObject(e)?$.each(e,function(e,r){return t(e,r),!1}):t(e,e)}):$.each(e,function(e,r){t(e,r)}))},Utils.fmt=function(e,t){return Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),e.replace(/{([0-9]+)}/g,function(e,r){return t[parseInt(r)]})},Utils.error=function(){var e=0,t="boolean"!=typeof arguments[e]||arguments[e++],r=arguments[e++],i=arguments[e++],o=Array.isArray(arguments[e])?arguments[e]:Array.prototype.slice.call(arguments,e);if(t){var n=new Error(Utils.fmt(i,o));throw n.name=r+"Error",n.args=o,n}console.error(r+"Error: "+Utils.fmt(i,o))},Utils.changeType=function(e,t,r){switch(t){case"integer":return parseInt(e);case"double":return parseFloat(e);case"boolean":var i="true"===e.trim().toLowerCase()||"1"===e.trim()||1===e;return r?i?1:0:i;default:return e}},Utils.escapeString=function(e){return"string"!=typeof e?e:e.replace(/[\0\n\r\b\\\'\"]/g,function(e){switch(e){case"\0":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+e}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")},Utils.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},Utils.escapeElementId=function(e){return e?e.replace(/(\\)?([:.\[\],])/g,function(e,t,r){return t?e:"\\"+r}):e},Utils.groupSort=function(e,t){var r=[],i=[];return e.forEach(function(e){var o;e[t]?-1==(o=r.lastIndexOf(e[t]))?o=r.length:o++:o=r.length,r.splice(o,0,e[t]),i.splice(o,0,e)}),i},$.fn.queryBuilder=function(e){0===this.length&&Utils.error("Config","No target defined"),this.length>1&&Utils.error("Config","Unable to initialize on multiple target");var t=this.data("queryBuilder"),r="object"==typeof e&&e||{};return t||"destroy"!=e?(t||this.data("queryBuilder",new QueryBuilder(this,r)),"string"==typeof e?t[e].apply(t,Array.prototype.slice.call(arguments,1)):this):this},$.fn.queryBuilder.constructor=QueryBuilder,$.fn.queryBuilder.defaults=QueryBuilder.defaults,$.fn.queryBuilder.extend=QueryBuilder.extend,$.fn.queryBuilder.define=QueryBuilder.define,$.fn.queryBuilder.regional=QueryBuilder.regional,QueryBuilder.define("bt-checkbox",function(e){if("glyphicons"==e.font){var t=document.createElement("style");t.innerHTML='.checkbox input[type=checkbox]:checked + label:after {     font-family: "Glyphicons Halflings";     content: "\\e013"; } .checkbox label:after {     padding-left: 4px;     padding-top: 2px;     font-size: 9px; }',document.body.appendChild(t)}this.on("getRuleInput.filter",function(t,r,i){var o=r.filter;if(("radio"===o.input||"checkbox"===o.input)&&!o.plugin){t.value="",o.colors||(o.colors={}),o.color&&(o.colors._def_=o.color);var n=o.vertical?' style="display:block"':"",l=0;Utils.iterateOptions(o.values,function(r,s){var a=o.colors[r]||o.colors._def_||e.color,u=i+"_"+l++;t.value+="<div"+n+' class="'+o.input+" "+o.input+"-"+a+'">   <input type="'+o.input+'" name="'+i+'" id="'+u+'" value="'+r+'">   <label for="'+u+'">'+s+"</label> </div>"})}})},{font:"glyphicons",color:"default"}),QueryBuilder.define("bt-selectpicker",function(e){$.fn.selectpicker&&$.fn.selectpicker.Constructor||Utils.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select'),this.on("afterCreateRuleFilters",function(t,r){r.$el.find(Selectors.rule_filter).removeClass("form-control").selectpicker(e)}),this.on("afterCreateRuleOperators",function(t,r){r.$el.find(Selectors.rule_operator).removeClass("form-control").selectpicker(e)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(Selectors.rule_filter).selectpicker("render")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(Selectors.rule_operator).selectpicker("render")})},{container:"body",style:"btn-inverse btn-xs",width:"auto",showIcon:!1}),QueryBuilder.define("bt-tooltip-errors",function(e){$.fn.tooltip&&$.fn.tooltip.Constructor&&$.fn.tooltip.Constructor.prototype._fixTitle||Utils.error("MissingLibrary",'Bootstrap Tooltip is required to use "bt-tooltip-errors" plugin. Get it here: http://getbootstrap.com');var t=this;this.on("getRuleTemplate.filter getGroupTemplate.filter",function(e){var t=$(e.value);t.find(Selectors.error_container).attr("data-toggle","tooltip"),e.value=t.prop("outerHTML")}),this.model.on("update",function(r,i,o){"error"==o&&t.settings.display_errors&&i.$el.find(Selectors.error_container).eq(0).tooltip(e).tooltip("hide").tooltip("_fixTitle")})},{placement:"right"}),QueryBuilder.extend({setFilters:function(e,t){var r=this;void 0===t&&(t=e,e=!1),t=this.checkFilters(t);var i=(t=this.change("setFilters",t)).map(function(e){return e.id});if(e||function e(t){t.each(function(e){e.filter&&-1===i.indexOf(e.filter.id)&&Utils.error("ChangeFilter",'A rule is using filter "{0}"',e.filter.id)},e)}(this.model.root),this.filters=t,function e(t){t.each(!0,function(e){e.filter&&-1===i.indexOf(e.filter.id)?e.drop():(r.createRuleFilters(e),e.$el.find(Selectors.rule_filter).val(e.filter?e.filter.id:"-1"),r.trigger("afterUpdateRuleFilter",e))},e)}(this.model.root),this.settings.plugins&&(this.settings.plugins["unique-filter"]&&this.updateDisabledFilters(),this.settings.plugins["bt-selectpicker"]&&this.$el.find(Selectors.rule_filter).selectpicker("render")),this.settings.default_filter)try{this.getFilterById(this.settings.default_filter)}catch(e){this.settings.default_filter=null}this.trigger("afterSetFilters",t)},addFilter:function(e,t){void 0===t||"#end"==t?t=this.filters.length:"#start"==t&&(t=0),$.isArray(e)||(e=[e]);var r=$.extend(!0,[],this.filters);parseInt(t)==t?Array.prototype.splice.apply(r,[t,0].concat(e)):this.filters.some(function(e,r){if(e.id==t)return t=r+1,!0})?Array.prototype.splice.apply(r,[t,0].concat(e)):Array.prototype.push.apply(r,e),this.setFilters(r)},removeFilter:function(e,t){var r=$.extend(!0,[],this.filters);"string"==typeof e&&(e=[e]),r=r.filter(function(t){return-1===e.indexOf(t.id)}),this.setFilters(t,r)}}),QueryBuilder.define("filter-description",function(e){"inline"===e.mode?this.on("afterUpdateRuleFilter",function(t,r){var i=r.$el.find("p.filter-description");r.filter&&r.filter.description?(0===i.length?(i=$('<p class="filter-description"></p>')).appendTo(r.$el):i.show(),i.html('<i class="'+e.icon+'"></i> '+r.filter.description)):i.hide()}):"popover"===e.mode?($.fn.popover&&$.fn.popover.Constructor&&$.fn.popover.Constructor.prototype._fixTitle||Utils.error("MissingLibrary",'Bootstrap Popover is required to use "filter-description" plugin. Get it here: http://getbootstrap.com'),this.on("afterUpdateRuleFilter",function(t,r){var i=r.$el.find("button.filter-description");r.filter&&r.filter.description?(0===i.length?((i=$('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="popover"><i class="'+e.icon+'"></i></button>')).prependTo(r.$el.find(Selectors.rule_actions)),i.popover({placement:"left",container:"body",html:!0}),i.on("mouseout",function(){i.popover("hide")})):i.show(),i.data("bs.popover").options.content=r.filter.description,i.attr("aria-describedby")&&i.popover("show")):(i.hide(),i.data("bs.popover")&&i.popover("hide"))})):"bootbox"===e.mode&&("bootbox"in window||Utils.error("MissingLibrary",'Bootbox is required to use "filter-description" plugin. Get it here: http://bootboxjs.com'),this.on("afterUpdateRuleFilter",function(t,r){var i=r.$el.find("button.filter-description");r.filter&&r.filter.description?(0===i.length&&((i=$('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="bootbox"><i class="'+e.icon+'"></i></button>')).prependTo(r.$el.find(Selectors.rule_actions)),i.on("click",function(){bootbox.alert(i.data("description"))})),i.data("description",r.filter.description)):i.hide()}))},{icon:"glyphicon glyphicon-info-sign",mode:"popover"}),QueryBuilder.defaults({operatorOpposites:{equal:"not_equal",not_equal:"equal",in:"not_in",not_in:"in",less:"greater_or_equal",less_or_equal:"greater",greater:"less_or_equal",greater_or_equal:"less",between:"not_between",not_between:"between",begins_with:"not_begins_with",not_begins_with:"begins_with",contains:"not_contains",not_contains:"contains",ends_with:"not_ends_with",not_ends_with:"ends_with",is_empty:"is_not_empty",is_not_empty:"is_empty",is_null:"is_not_null",is_not_null:"is_null"},conditionOpposites:{AND:"OR",OR:"AND"}}),QueryBuilder.define("invert",function(e){var t=this;this.on("afterInit",function(){t.$el.on("click.queryBuilder","[data-invert=group]",function(){var r=$(this).closest(Selectors.group_container);t.invert(Model(r),e)}),e.display_rules_button&&e.invert_rules&&t.$el.on("click.queryBuilder","[data-invert=rule]",function(){var r=$(this).closest(Selectors.rule_container);t.invert(Model(r),e)})}),this.on("getGroupTemplate.filter",function(r,i){var o=$(r.value);o.find(Selectors.condition_container).after('<button type="button" class="btn btn-xs btn-default" data-invert="group"><i class="'+e.icon+'"></i> '+t.lang.invert+"</button>"),r.value=o.prop("outerHTML")}),e.display_rules_button&&e.invert_rules&&this.on("getRuleTemplate.filter",function(r){var i=$(r.value);i.find(Selectors.rule_actions).prepend('<button type="button" class="btn btn-xs btn-default" data-invert="rule"><i class="'+e.icon+'"></i> '+t.lang.invert+"</button>"),r.value=i.prop("outerHTML")})},{icon:"glyphicon glyphicon-random",recursive:!0,invert_rules:!0,display_rules_button:!1,silent_fail:!1}),QueryBuilder.extend({invert:function(e,t){if(!(e instanceof Node)){if(!this.model.root)return;t=e,e=this.model.root}if("object"!=typeof t&&(t={}),void 0===t.recursive&&(t.recursive=!0),void 0===t.invert_rules&&(t.invert_rules=!0),void 0===t.silent_fail&&(t.silent_fail=!1),void 0===t.trigger&&(t.trigger=!0),e instanceof Group){if(this.settings.conditionOpposites[e.condition]?e.condition=this.settings.conditionOpposites[e.condition]:t.silent_fail||Utils.error("InvertCondition",'Unknown inverse of condition "{0}"',e.condition),t.recursive){var r=$.extend({},t,{trigger:!1});e.each(function(e){t.invert_rules&&this.invert(e,r)},function(e){this.invert(e,r)},this)}}else if(e instanceof Rule&&e.operator&&!e.filter.no_invert)if(this.settings.operatorOpposites[e.operator.type]){var i=this.settings.operatorOpposites[e.operator.type];e.filter.operators&&-1==e.filter.operators.indexOf(i)||(e.operator=this.getOperatorByType(i))}else t.silent_fail||Utils.error("InvertOperator",'Unknown inverse of operator "{0}"',e.operator.type);t.trigger&&this.trigger("afterInvert",e,t)}}),QueryBuilder.defaults({mongoOperators:{equal:function(e){return e[0]},not_equal:function(e){return{$ne:e[0]}},in:function(e){return{$in:e}},not_in:function(e){return{$nin:e}},less:function(e){return{$lt:e[0]}},less_or_equal:function(e){return{$lte:e[0]}},greater:function(e){return{$gt:e[0]}},greater_or_equal:function(e){return{$gte:e[0]}},between:function(e){return{$gte:e[0],$lte:e[1]}},not_between:function(e){return{$lt:e[0],$gt:e[1]}},begins_with:function(e){return{$regex:"^"+Utils.escapeRegExp(e[0])}},not_begins_with:function(e){return{$regex:"^(?!"+Utils.escapeRegExp(e[0])+")"}},contains:function(e){return{$regex:Utils.escapeRegExp(e[0])}},not_contains:function(e){return{$regex:"^((?!"+Utils.escapeRegExp(e[0])+").)*$",$options:"s"}},ends_with:function(e){return{$regex:Utils.escapeRegExp(e[0])+"$"}},not_ends_with:function(e){return{$regex:"(?<!"+Utils.escapeRegExp(e[0])+")$"}},is_empty:function(e){return""},is_not_empty:function(e){return{$ne:""}},is_null:function(e){return null},is_not_null:function(e){return{$ne:null}}},mongoRuleOperators:{$ne:function(e){return{val:e=e.$ne,op:null===e?"is_not_null":""===e?"is_not_empty":"not_equal"}},eq:function(e){return{val:e,op:null===e?"is_null":""===e?"is_empty":"equal"}},$regex:function(e){return"^(?!"==(e=e.$regex).slice(0,4)&&")"==e.slice(-1)?{val:e.slice(4,-1),op:"not_begins_with"}:"^((?!"==e.slice(0,5)&&").)*$"==e.slice(-5)?{val:e.slice(5,-5),op:"not_contains"}:"(?<!"==e.slice(0,4)&&")$"==e.slice(-2)?{val:e.slice(4,-2),op:"not_ends_with"}:"$"==e.slice(-1)?{val:e.slice(0,-1),op:"ends_with"}:"^"==e.slice(0,1)?{val:e.slice(1),op:"begins_with"}:{val:e,op:"contains"}},between:function(e){return{val:[e.$gte,e.$lte],op:"between"}},not_between:function(e){return{val:[e.$lt,e.$gt],op:"not_between"}},$in:function(e){return{val:e.$in,op:"in"}},$nin:function(e){return{val:e.$nin,op:"not_in"}},$lt:function(e){return{val:e.$lt,op:"less"}},$lte:function(e){return{val:e.$lte,op:"less_or_equal"}},$gt:function(e){return{val:e.$gt,op:"greater"}},$gte:function(e){return{val:e.$gte,op:"greater_or_equal"}}}}),QueryBuilder.extend({getMongo:function(e){e=void 0===e?this.getRules():e;var t=this;return function e(r){if(r.condition||(r.condition=t.settings.default_condition),-1===["AND","OR"].indexOf(r.condition.toUpperCase())&&Utils.error("UndefinedMongoCondition",'Unable to build MongoDB query with condition "{0}"',r.condition),!r.rules)return{};var i=[];r.rules.forEach(function(r){if(r.rules&&r.rules.length>0)i.push(e(r));else{var o=t.settings.mongoOperators[r.operator],n=t.getOperatorByType(r.operator),l=[];void 0===o&&Utils.error("UndefinedMongoOperator",'Unknown MongoDB operation for operator "{0}"',r.operator),0!==n.nb_inputs&&(r.value instanceof Array||(r.value=[r.value]),r.value.forEach(function(e){l.push(Utils.changeType(e,r.type,!1))}));var s={};s[t.change("getMongoDBField",r.field,r)]=o.call(t,l),i.push(t.change("ruleToMongo",s,r,l,o))}});var o={};return o["$"+r.condition.toLowerCase()]=i,t.change("groupToMongo",o,r)}(e)},getRulesFromMongo:function(e){if(null==e)return null;var t=this;if("rules"in(e=t.change("parseMongoNode",e))&&"condition"in e)return e;var r=andOr(e);return r||Utils.error("MongoParse","Invalid MongoDB query format"),function e(r,i){var o=r[i],n=[];return o.forEach(function(r){if("rules"in(r=t.change("parseMongoNode",r))&&"condition"in r)n.push(r);else if("id"in r&&"operator"in r&&"value"in r)n.push(r);else{var i=andOr(r);if(i)n.push(e(r,i));else{var o=Object.keys(r)[0],l=r[o],s=determineMongoOperator(l,o);void 0===s&&Utils.error("MongoParse","Invalid MongoDB query format");var a=t.settings.mongoRuleOperators[s];void 0===a&&Utils.error("UndefinedMongoOperator",'JSON Rule operation unknown for operator "{0}"',s);var u=a.call(t,l),p=t.change("mongoToRule",{id:t.change("getMongoDBFieldID",o,l),field:o,operator:u.op,value:u.val},r);n.push(p)}}}),t.change("mongoToGroup",{condition:i.replace("$","").toUpperCase(),rules:n},r)}(e,r)},setRulesFromMongo:function(e){this.setRules(this.getRulesFromMongo(e))}}),Selectors.group_not=Selectors.group_header+" [data-not=group]",Model.defineModelProperties(Group,["not"]),QueryBuilder.define("not-group",function(e){var t=this;this.on("afterInit",function(){t.$el.on("click.queryBuilder","[data-not=group]",function(){var e=Model($(this).closest(Selectors.group_container));e.not=!e.not}),t.model.on("update",function(e,r,i){r instanceof Group&&"not"===i&&t.updateGroupNot(r)})}),this.on("afterAddGroup",function(e,t){t.__.not=!1}),this.on("getGroupTemplate.filter",function(r,i){var o=$(r.value);o.find(Selectors.condition_container).prepend('<button type="button" class="btn btn-xs btn-default" data-not="group"><i class="'+e.icon_unchecked+'"></i> '+t.lang.NOT+"</button>"),r.value=o.prop("outerHTML")}),this.on("groupToJson.filter",function(e,t){e.value.not=t.not}),this.on("jsonToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToSQL.filter",function(e,t){t.not&&(e.value="NOT ( "+e.value+" )")}),this.on("parseSQLNode.filter",function(e){e.value.name&&"NOT"==e.value.name.toUpperCase()&&(e.value=e.value.arguments.value[0],e.value.not=!0)}),this.on("sqlToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToMongo.filter",function(e,t){var r="$"+t.condition.toLowerCase();t.not&&e.value[r]&&(e.value={$nor:[e.value]})}),this.on("parseMongoNode.filter",function(e){var t=Object.keys(e.value);"$nor"==t[0]&&(e.value=e.value[t[0]][0],e.value.not=!0)}),this.on("mongoToGroup.filter",function(e,t){e.value.not=!!t.not})},{icon_unchecked:"glyphicon glyphicon-unchecked",icon_checked:"glyphicon glyphicon-check"}),QueryBuilder.extend({updateGroupNot:function(e){var t=this.plugins["not-group"];e.$el.find(">"+Selectors.group_not).toggleClass("active",e.not).find("i").attr("class",e.not?t.icon_checked:t.icon_unchecked),this.trigger("afterUpdateGroupNot",e)}}),Selectors.rule_and_group_containers=Selectors.rule_container+", "+Selectors.group_container,Selectors.drag_handle=".drag-handle",QueryBuilder.defaults({default_rule_flags:{no_sortable:!1,no_drop:!1},default_group_flags:{no_sortable:!1,no_drop:!1}}),QueryBuilder.define("sortable",function(e){var t,r,i;"interact"in window||Utils.error("MissingLibrary",'interact.js is required to use "sortable" plugin. Get it here: http://interactjs.io'),void 0!==e.default_no_sortable&&(Utils.error(!1,"Config",'Sortable plugin : "default_no_sortable" options is deprecated, use standard "default_rule_flags" and "default_group_flags" instead'),this.settings.default_rule_flags.no_sortable=this.settings.default_group_flags.no_sortable=e.default_no_sortable),interact.dynamicDrop(!0),interact.pointerMoveTolerance(10),this.on("afterAddRule afterAddGroup",function(o,n){if(n!=t){var l=o.builder;e.inherit_no_sortable&&n.parent&&n.parent.flags.no_sortable&&(n.flags.no_sortable=!0),e.inherit_no_drop&&n.parent&&n.parent.flags.no_drop&&(n.flags.no_drop=!0),n.flags.no_sortable||interact(n.$el[0]).allowFrom(Selectors.drag_handle).draggable({onstart:function(e){i=Model(e.target),r=i.$el.clone().appendTo(i.$el.parent()).width(i.$el.outerWidth()).addClass("dragging");var o=$('<div class="rule-placeholder">&nbsp;</div>').height(i.$el.outerHeight());t=i.parent.addRule(o,i.getPos()),i.$el.hide()},onmove:function(e){r[0].style.top=e.clientY-15+"px",r[0].style.left=e.clientX-15+"px"},onend:function(){r.remove(),r=void 0,t.drop(),t=void 0,i.$el.show(),l.trigger("afterMove",i)}}),n.flags.no_drop||(interact(n.$el[0]).dropzone({accept:Selectors.rule_and_group_containers,ondragenter:function(e){moveSortableToTarget(t,$(e.target))},ondrop:function(e){moveSortableToTarget(i,$(e.target),l)}}),n instanceof Group&&interact(n.$el.find(Selectors.group_header)[0]).dropzone({accept:Selectors.rule_and_group_containers,ondragenter:function(e){moveSortableToTarget(t,$(e.target))},ondrop:function(e){moveSortableToTarget(i,$(e.target),l)}}))}}),this.on("beforeDeleteRule beforeDeleteGroup",function(e,t){e.isDefaultPrevented()||(interact(t.$el[0]).unset(),t instanceof Group&&interact(t.$el.find(Selectors.group_header)[0]).unset())}),this.on("afterApplyRuleFlags afterApplyGroupFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),this.on("getGroupTemplate.filter",function(t,r){if(r>1){var i=$(t.value);i.find(Selectors.condition_container).after('<div class="drag-handle"><i class="'+e.icon+'"></i></div>'),t.value=i.prop("outerHTML")}}),this.on("getRuleTemplate.filter",function(t){var r=$(t.value);r.find(Selectors.rule_header).after('<div class="drag-handle"><i class="'+e.icon+'"></i></div>'),t.value=r.prop("outerHTML")})},{inherit_no_sortable:!0,inherit_no_drop:!0,icon:"glyphicon glyphicon-sort"}),QueryBuilder.defaults({sqlOperators:{equal:{op:"= ?"},not_equal:{op:"!= ?"},in:{op:"IN(?)",sep:", "},not_in:{op:"NOT IN(?)",sep:", "},less:{op:"< ?"},less_or_equal:{op:"<= ?"},greater:{op:"> ?"},greater_or_equal:{op:">= ?"},between:{op:"BETWEEN ?",sep:" AND "},not_between:{op:"NOT BETWEEN ?",sep:" AND "},begins_with:{op:"LIKE(?)",mod:"{0}%"},not_begins_with:{op:"NOT LIKE(?)",mod:"{0}%"},contains:{op:"LIKE(?)",mod:"%{0}%"},not_contains:{op:"NOT LIKE(?)",mod:"%{0}%"},ends_with:{op:"LIKE(?)",mod:"%{0}"},not_ends_with:{op:"NOT LIKE(?)",mod:"%{0}"},is_empty:{op:"= ''"},is_not_empty:{op:"!= ''"},is_null:{op:"IS NULL"},is_not_null:{op:"IS NOT NULL"}},sqlRuleOperator:{"=":function(e){return{val:e,op:""===e?"is_empty":"equal"}},"!=":function(e){return{val:e,op:""===e?"is_not_empty":"not_equal"}},LIKE:function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"begins_with"}:void Utils.error("SQLParse",'Invalid value for LIKE operator "{0}"',e)},"NOT LIKE":function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"not_contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"not_ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"not_begins_with"}:void Utils.error("SQLParse",'Invalid value for NOT LIKE operator "{0}"',e)},IN:function(e){return{val:e,op:"in"}},"NOT IN":function(e){return{val:e,op:"not_in"}},"<":function(e){return{val:e,op:"less"}},"<=":function(e){return{val:e,op:"less_or_equal"}},">":function(e){return{val:e,op:"greater"}},">=":function(e){return{val:e,op:"greater_or_equal"}},BETWEEN:function(e){return{val:e,op:"between"}},"NOT BETWEEN":function(e){return{val:e,op:"not_between"}},IS:function(e){return null!==e&&Utils.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_null"}},"IS NOT":function(e){return null!==e&&Utils.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_not_null"}}},sqlStatements:{question_mark:function(){var e=[];return{add:function(t,r){return e.push(r),"?"},run:function(){return e}}},numbered:function(e){(!e||e.length>1)&&(e="$");var t=0,r=[];return{add:function(i,o){return r.push(o),e+ ++t},run:function(){return r}}},named:function(e){(!e||e.length>1)&&(e=":");var t={},r={};return{add:function(i,o){t[i.field]||(t[i.field]=1);var n=i.field+"_"+t[i.field]++;return r[n]=o,e+n},run:function(){return r}}}},sqlRuleStatement:{question_mark:function(e){var t=0;return{parse:function(r){return"?"==r?e[t++]:r},esc:function(e){return e.replace(/\?/g,"'?'")}}},numbered:function(e,t){(!t||t.length>1)&&(t="$");var r=new RegExp("^\\"+t+"[0-9]+$"),i=new RegExp("\\"+t+"([0-9]+)","g");return{parse:function(t){return r.test(t)?e[t.slice(1)-1]:t},esc:function(e){return e.replace(i,"'"+("$"==t?"$$":t)+"$1'")}}},named:function(e,t){(!t||t.length>1)&&(t=":");var r=new RegExp("^\\"+t),i=new RegExp("\\"+t+"("+Object.keys(e).join("|")+")","g");return{parse:function(t){return r.test(t)?e[t.slice(1)]:t},esc:function(e){return e.replace(i,"'"+("$"==t?"$$":t)+"$1'")}}}}}),QueryBuilder.extend({getSQL:function(e,t,r){if(r=void 0===r?this.getRules():r,t=!0===t?"\n":" ",!0===e&&(e="question_mark"),"string"==typeof e){var i=getStmtConfig(e);e=this.settings.sqlStatements[i[1]](i[2])}var o=this,n=function r(i){if(i.condition||(i.condition=o.settings.default_condition),-1===["AND","OR"].indexOf(i.condition.toUpperCase())&&Utils.error("UndefinedSQLCondition",'Unable to build SQL query with condition "{0}"',i.condition),!i.rules)return"";var n=[];i.rules.forEach(function(i){if(i.rules&&i.rules.length>0)n.push("("+t+r(i)+t+")"+t);else{var l=o.settings.sqlOperators[i.operator],s=o.getOperatorByType(i.operator),a="";void 0===l&&Utils.error("UndefinedSQLOperator",'Unknown SQL operation for operator "{0}"',i.operator),0!==s.nb_inputs&&(i.value instanceof Array||(i.value=[i.value]),i.value.forEach(function(t,r){r>0&&(a+=l.sep),"integer"==i.type||"double"==i.type||"boolean"==i.type?t=Utils.changeType(t,i.type,!0):e||(t=Utils.escapeString(t)),l.mod&&(t=Utils.fmt(l.mod,t)),e?a+=e.add(i,t):("string"==typeof t&&(t="'"+t+"'"),a+=t)}));var u=function(e){return l.op.replace(/\?/,e)},p=o.change("getSQLField",i.field,i)+" "+u(a);n.push(o.change("ruleToSQL",p,i,a,u))}});var l=n.join(" "+i.condition+t);return o.change("groupToSQL",l,i)}(r);return e?{sql:n,params:e.run()}:{sql:n}},getRulesFromSQL:function(e,t){"SQLParser"in window||Utils.error("MissingLibrary","SQLParser is required to parse SQL queries. Get it here https://github.com/mistic100/sql-parser");var r=this;if("string"==typeof e&&(e={sql:e}),!0===t&&(t="question_mark"),"string"==typeof t){var i=getStmtConfig(t);t=this.settings.sqlRuleStatement[i[1]](e.params,i[2])}t&&(e.sql=t.esc(e.sql)),0!==e.sql.toUpperCase().indexOf("SELECT")&&(e.sql="SELECT * FROM table WHERE "+e.sql);var o=SQLParser.parse(e.sql);if(o.where||Utils.error("SQLParse","No WHERE clause found"),"rules"in(e=r.change("parseSQLNode",o.where.conditions))&&"condition"in e)return e;var n=r.change("sqlToGroup",{condition:this.settings.default_condition,rules:[]},e),l=n;return function e(i,o){if("rules"in(i=r.change("parseSQLNode",i))&&"condition"in i)l.rules.push(i);else if("id"in i&&"operator"in i&&"value"in i)l.rules.push(i);else if("left"in i&&"right"in i&&"operation"in i||Utils.error("SQLParse","Unable to parse WHERE clause"),-1!==["AND","OR"].indexOf(i.operation.toUpperCase())){if(o>0&&l.condition!=i.operation.toUpperCase()){var n=r.change("sqlToGroup",{condition:r.settings.default_condition,rules:[]},i);l.rules.push(n),l=n}l.condition=i.operation.toUpperCase(),o++;var s=l;e(i.left,o),l=s,e(i.right,o)}else{var a;$.isPlainObject(i.right.value)&&Utils.error("SQLParse","Value format not supported for {0}.",i.left.value),a=$.isArray(i.right.value)?i.right.value.map(function(e){return e.value}):i.right.value,t&&(a=$.isArray(a)?a.map(t.parse):t.parse(a));var u=i.operation.toUpperCase();"<>"==u&&(u="!=");var p=r.settings.sqlRuleOperator[u];void 0===p&&Utils.error("UndefinedSQLOperator",'Invalid SQL operation "{0}".',i.operation);var d=p.call(this,a,i.operation),c=i.left.values.join("."),f=r.change("sqlToRule",{id:r.change("getSQLFieldID",c,a),field:c,operator:d.op,value:d.val},i);l.rules.push(f)}}(e,0),n},setRulesFromSQL:function(e,t){this.setRules(this.getRulesFromSQL(e,t))}}),QueryBuilder.define("unique-filter",function(){this.status.used_filters={},this.on("afterUpdateRuleFilter",this.updateDisabledFilters),this.on("afterDeleteRule",this.updateDisabledFilters),this.on("afterCreateRuleFilters",this.applyDisabledFilters),this.on("afterReset",this.clearDisabledFilters),this.on("afterClear",this.clearDisabledFilters),this.on("getDefaultFilter.filter",function(e,t){var r=e.builder;(r.updateDisabledFilters(),e.value.id in r.status.used_filters)&&(r.filters.some(function(i){if(!(i.id in r.status.used_filters)||r.status.used_filters[i.id].length>0&&-1===r.status.used_filters[i.id].indexOf(t.parent))return e.value=i,!0})||(Utils.error("UniqueFilter","No more non-unique filters available"),e.value=void 0))})}),QueryBuilder.extend({updateDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.model&&(!function e(r){r.each(function(e){e.filter&&e.filter.unique&&(t.status.used_filters[e.filter.id]||(t.status.used_filters[e.filter.id]=[]),"group"==e.filter.unique&&t.status.used_filters[e.filter.id].push(e.parent))},function(t){e(t)})}(t.model.root),t.applyDisabledFilters(e))},clearDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.applyDisabledFilters(e)},applyDisabledFilters:function(e){var t=e?e.builder:this;t.$el.find(Selectors.filter_container+" option").prop("disabled",!1),$.each(t.status.used_filters,function(e,r){0===r.length?t.$el.find(Selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0):r.forEach(function(t){t.each(function(t){t.$el.find(Selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0)})})}),t.settings.plugins&&t.settings.plugins["bt-selectpicker"]&&t.$el.find(Selectors.rule_filter).selectpicker("render")}}),QueryBuilder.regional.en={__locale:"English (en)",__author:'Damien "Mistic" Sorel, http://www.strangeplanet.fr',add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",conditions:{AND:"AND",OR:"OR"},operators:{equal:"equal",not_equal:"not equal",in:"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",datetime_empty:"Empty value",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",boolean_not_valid:"Not a boolean",operator_not_multiple:"Operator {0} cannot accept multiple values"},invert:"Invert",NOT:"NOT"},QueryBuilder.defaults({lang_code:"en"});

/* interact.js v1.2.8 | https://raw.github.com/taye/interact.js/master/LICENSE */
function interactCustom(t){"use strict";if(t){var e,i,r,s=(r=t.document.createTextNode("")).ownerDocument!==t.document&&"function"==typeof t.wrap&&t.wrap(r)===r?t.wrap(t):t,n=s.document,o=s.DocumentFragment||V,a=s.SVGElement||V,h=s.SVGSVGElement||V,p=s.SVGElementInstance||V,l=s.HTMLElement||s.Element,c=s.PointerEvent||s.MSPointerEvent,d=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)},u={},g=[],v=[],m=[],f=!1,y={},x={base:{accept:null,actionChecker:null,styleCursor:!0,preventDefault:"auto",origin:{x:0,y:0},deltaSource:"page",allowFrom:null,ignoreFrom:null,_context:n,dropChecker:null},drag:{enabled:!1,manualStart:!0,max:1/0,maxPerElement:1,snap:null,restrict:null,inertia:null,autoScroll:null,axis:"xy"},drop:{enabled:!1,accept:null,overlap:"pointer"},resize:{enabled:!1,manualStart:!1,max:1/0,maxPerElement:1,snap:null,restrict:null,inertia:null,autoScroll:null,square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},gesture:{manualStart:!1,enabled:!1,max:1/0,maxPerElement:1,restrict:null},perAction:{manualStart:!1,max:1/0,maxPerElement:1,snap:{enabled:!1,endOnly:!1,range:1/0,targets:null,offsets:null,relativePoints:null},restrict:{enabled:!1,endOnly:!1},autoScroll:{enabled:!1,container:null,margin:60,speed:300},inertia:{enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,zeroResumeDelta:!0,smoothEndDuration:300}},_holdDuration:600},E={interaction:null,i:null,x:0,y:0,scroll:function(){var t,e,i,r,s=E.interaction.target.options[E.interaction.prepared.name].autoScroll,n=s.container||ct(E.interaction.element),o=(new Date).getTime(),a=(o-E.prevTimeX)/1e3,h=(o-E.prevTimeY)/1e3;s.velocity?(t=s.velocity.x,e=s.velocity.y):t=e=s.speed,r=e*h,((i=t*a)>=1||r>=1)&&(G(n)?n.scrollBy(E.x*i,E.y*r):n&&(n.scrollLeft+=E.x*i,n.scrollTop+=E.y*r),i>=1&&(E.prevTimeX=o),r>=1&&(E.prevTimeY=o)),E.isScrolling&&(R(E.i),E.i=Y(E.scroll))},isScrolling:!1,prevTimeX:0,prevTimeY:0,start:function(t){E.isScrolling=!0,R(E.i),E.interaction=t,E.prevTimeX=(new Date).getTime(),E.prevTimeY=(new Date).getTime(),E.i=Y(E.scroll)},stop:function(){E.isScrolling=!1,R(E.i)}},S="ontouchstart"in s||s.DocumentTouch&&n instanceof s.DocumentTouch,b=c&&!/Chrome/.test(navigator.userAgent),w=S||b?20:10,z=1,D=0,T=1/0,C=n.all&&!s.atob?{drag:"move",resizex:"e-resize",resizey:"s-resize",resizexy:"se-resize",resizetop:"n-resize",resizeleft:"w-resize",resizebottom:"s-resize",resizeright:"e-resize",resizetopleft:"se-resize",resizebottomright:"se-resize",resizetopright:"ne-resize",resizebottomleft:"ne-resize",gesture:""}:{drag:"move",resizex:"ew-resize",resizey:"ns-resize",resizexy:"nwse-resize",resizetop:"ns-resize",resizeleft:"ew-resize",resizebottom:"ns-resize",resizeright:"ew-resize",resizetopleft:"nwse-resize",resizebottomright:"nwse-resize",resizetopright:"nesw-resize",resizebottomleft:"nesw-resize",gesture:""},M={drag:!0,resize:!0,gesture:!0},P="onmousewheel"in n?"mousewheel":"wheel",A=["dragstart","dragmove","draginertiastart","dragend","dragenter","dragleave","dropactivate","dropdeactivate","dropmove","drop","resizestart","resizemove","resizeinertiastart","resizeend","gesturestart","gesturemove","gestureinertiastart","gestureend","down","move","up","cancel","tap","doubletap","hold"],O={},_="Opera"==navigator.appName&&S&&navigator.userAgent.match("Presto"),k=/iP(hone|od|ad)/.test(navigator.platform)&&/OS 7[^\d]/.test(navigator.appVersion),X="matches"in Element.prototype?"matches":"webkitMatchesSelector"in Element.prototype?"webkitMatchesSelector":"mozMatchesSelector"in Element.prototype?"mozMatchesSelector":"oMatchesSelector"in Element.prototype?"oMatchesSelector":"msMatchesSelector",Y=t.requestAnimationFrame,R=t.cancelAnimationFrame,I=function(){var t="attachEvent"in s&&!("addEventListener"in s),e=t?"attachEvent":"addEventListener",i=t?"detachEvent":"removeEventListener",r=t?"on":"",n=[],o=[],a=[];function h(){this.returnValue=!1}function p(){this.cancelBubble=!0}function l(){this.cancelBubble=!0,this.immediatePropagationStopped=!0}return{add:function(i,s,c,d){var u=jt(n,i),g=o[u];if(g||(g={events:{},typeCount:0},u=n.push(i)-1,o.push(g),a.push(t?{supplied:[],wrapped:[],useCount:[]}:null)),g.events[s]||(g.events[s]=[],g.typeCount++),!Bt(g.events[s],c)){var v;if(t){var m=a[u],f=jt(m.supplied,c),y=m.wrapped[f]||function(t){t.immediatePropagationStopped||(t.target=t.srcElement,t.currentTarget=i,t.preventDefault=t.preventDefault||h,t.stopPropagation=t.stopPropagation||p,t.stopImmediatePropagation=t.stopImmediatePropagation||l,/mouse|click/.test(t.type)&&(t.pageX=t.clientX+ct(i).document.documentElement.scrollLeft,t.pageY=t.clientY+ct(i).document.documentElement.scrollTop),c(t))};v=i[e](r+s,y,Boolean(d)),-1===f?(m.supplied.push(c),m.wrapped.push(y),m.useCount.push(1)):m.useCount[f]++}else v=i[e](s,c,d||!1);return g.events[s].push(c),v}},remove:function e(s,h,p,l){var c,d,u,g=jt(n,s),v=o[g],m=p;if(v&&v.events)if(t&&(u=jt((d=a[g]).supplied,p),m=d.wrapped[u]),"all"!==h){if(v.events[h]){var f=v.events[h].length;if("all"===p){for(c=0;c<f;c++)e(s,h,v.events[h][c],Boolean(l));return}for(c=0;c<f;c++)if(v.events[h][c]===p){s[i](r+h,m,l||!1),v.events[h].splice(c,1),t&&d&&(d.useCount[u]--,0===d.useCount[u]&&(d.supplied.splice(u,1),d.wrapped.splice(u,1),d.useCount.splice(u,1)));break}v.events[h]&&0===v.events[h].length&&(v.events[h]=null,v.typeCount--)}v.typeCount||(o.splice(g,1),n.splice(g,1),a.splice(g,1))}else for(h in v.events)v.events.hasOwnProperty(h)&&e(s,h,"all")},useAttachEvent:t,_elements:n,_targets:o,_attachedListeners:a}}(),F={webkit:/(Movement[XY]|Radius[XY]|RotationAngle|Force)$/};_t.prototype={getPageXY:function(t,e){return at(t,e)},getClientXY:function(t,e){return ht(t,e)},setEventXY:function(t,e){return i=t,at(s=(r=e).length>1?vt(r):r[0],u),i.page.x=u.x,i.page.y=u.y,ht(s,u),i.client.x=u.x,i.client.y=u.y,void(i.timeStamp=(new Date).getTime());var i,r,s},pointerOver:function(t,i,r){if(!this.prepared.name&&this.mouse){var s=[],n=[],o=this.element;this.addPointer(t),!this.target||!Tt(this.target,this.element,r)&&Ct(this.target,this.element,r)||(this.target=null,this.element=null,this.matches=[],this.matchElements=[]);var a=v.get(r),h=a&&!Tt(a,r,r)&&Ct(a,r,r)&&qt(a.getAction(t,i,this,r),a);h&&!Ot(a,r,h)&&(h=null),h?(this.target=a,this.element=r,this.matches=[],this.matchElements=[]):(v.forEachSelector(function(t,e){t&&Dt(t,r)&&!Tt(t,r,r)&&Ct(t,r,r)&&Kt(r,e)&&(s.push(t),n.push(r))}),this.validateSelector(t,i,s,n)?(this.matches=s,this.matchElements=n,this.pointerHover(t,i,this.matches,this.matchElements),I.add(r,b?e.move:"mousemove",N.pointerHover)):this.target&&(bt(o,r)?(this.pointerHover(t,i,this.matches,this.matchElements),I.add(this.element,b?e.move:"mousemove",N.pointerHover)):(this.target=null,this.element=null,this.matches=[],this.matchElements=[])))}},pointerHover:function(t,e,i,r,s,n){var o,a=this.target;!this.prepared.name&&this.mouse?(this.setEventXY(this.curCoords,[t]),s?o=this.validateSelector(t,e,s,n):a&&(o=qt(a.getAction(this.pointers[0],e,this,this.element),this.target)),a&&a.options.styleCursor&&(a._doc.documentElement.style.cursor=o?It(o):"")):this.prepared.name&&this.checkAndPreventDefault(e,a,this.element)},pointerOut:function(t,i,r){this.prepared.name||(v.get(r)||I.remove(r,b?e.move:"mousemove",N.pointerHover),this.target&&this.target.options.styleCursor&&!this.interacting()&&(this.target._doc.documentElement.style.cursor=""))},selectorDown:function(t,e,r,s){var n,o=this,a=I.useAttachEvent?et({},e):e,h=r,p=this.addPointer(t);if(this.holdTimers[p]=setTimeout(function(){o.pointerHold(I.useAttachEvent?a:t,a,r,s)},x._holdDuration),this.pointerIsDown=!0,this.inertiaStatus.active&&this.target.selector)for(;$(h);){if(h===this.element&&qt(this.target.getAction(t,e,this,this.element),this.target).name===this.prepared.name)return R(this.inertiaStatus.i),this.inertiaStatus.active=!1,void this.collectEventTargets(t,e,r,"down");h=zt(h)}if(this.interacting())this.collectEventTargets(t,e,r,"down");else{for(this.setEventXY(this.curCoords,[t]),this.downEvent=e;$(h)&&!n;)this.matches=[],this.matchElements=[],v.forEachSelector(l),n=this.validateSelector(t,e,this.matches,this.matchElements),h=zt(h);if(n)return this.prepared.name=n.name,this.prepared.axis=n.axis,this.prepared.edges=n.edges,this.collectEventTargets(t,e,r,"down"),this.pointerDown(t,e,r,s,n);this.downTimes[p]=(new Date).getTime(),this.downTargets[p]=r,it(this.downPointer,t),rt(this.prevCoords,this.curCoords),this.pointerWasMoved=!1,this.collectEventTargets(t,e,r,"down")}function l(t,e,s){var n=i?s.querySelectorAll(e):void 0;Dt(t,h)&&!Tt(t,h,r)&&Ct(t,h,r)&&Kt(h,e,n)&&(o.matches.push(t),o.matchElements.push(h))}},pointerDown:function(t,e,i,r,s){if(s||this.inertiaStatus.active||!this.pointerWasMoved||!this.prepared.name){this.pointerIsDown=!0,this.downEvent=e;var n,o=this.addPointer(t);if(this.pointerIds.length>1&&this.target._element===this.element){var a=qt(s||this.target.getAction(t,e,this,this.element),this.target);Ot(this.target,this.element,a)&&(n=a),this.prepared.name=null}else if(!this.prepared.name){var h=v.get(r);h&&!Tt(h,r,i)&&Ct(h,r,i)&&(n=qt(s||h.getAction(t,e,this,r),h))&&Ot(h,r,n)&&(this.target=h,this.element=r)}var p=this.target,l=p&&p.options;if(!p||!s&&this.prepared.name)this.inertiaStatus.active&&r===this.element&&qt(p.getAction(t,e,this,this.element),p).name===this.prepared.name&&(R(this.inertiaStatus.i),this.inertiaStatus.active=!1,this.checkAndPreventDefault(e,p,this.element));else{if(n=n||qt(s||p.getAction(t,e,this,r),p,this.element),this.setEventXY(this.startCoords,this.pointers),!n)return;l.styleCursor&&(p._doc.documentElement.style.cursor=It(n)),this.resizeAxes="resize"===n.name?n.axis:null,"gesture"===n&&this.pointerIds.length<2&&(n=null),this.prepared.name=n.name,this.prepared.axis=n.axis,this.prepared.edges=n.edges,this.snapStatus.snappedX=this.snapStatus.snappedY=this.restrictStatus.restrictedX=this.restrictStatus.restrictedY=NaN,this.downTimes[o]=(new Date).getTime(),this.downTargets[o]=i,it(this.downPointer,t),rt(this.prevCoords,this.startCoords),this.pointerWasMoved=!1,this.checkAndPreventDefault(e,p,this.element)}}else this.checkAndPreventDefault(e,this.target,this.element)},setModifications:function(t,e){var i=this.target,r=!0,s=Pt(i,this.prepared.name)&&(!i.options[this.prepared.name].snap.endOnly||e),n=At(i,this.prepared.name)&&(!i.options[this.prepared.name].restrict.endOnly||e);return s?this.setSnapping(t):this.snapStatus.locked=!1,n?this.setRestriction(t):this.restrictStatus.restricted=!1,s&&this.snapStatus.locked&&!this.snapStatus.changed?r=n&&this.restrictStatus.restricted&&this.restrictStatus.changed:n&&this.restrictStatus.restricted&&!this.restrictStatus.changed&&(r=!1),r},setStartOffsets:function(t,e,i){var r,s,n=e.getRect(i),o=xt(e,i),a=e.options[this.prepared.name].snap,h=e.options[this.prepared.name].restrict;n?(this.startOffset.left=this.startCoords.page.x-n.left,this.startOffset.top=this.startCoords.page.y-n.top,this.startOffset.right=n.right-this.startCoords.page.x,this.startOffset.bottom=n.bottom-this.startCoords.page.y,r="width"in n?n.width:n.right-n.left,s="height"in n?n.height:n.bottom-n.top):this.startOffset.left=this.startOffset.top=this.startOffset.right=this.startOffset.bottom=0,this.snapOffsets.splice(0);var p=a&&"startCoords"===a.offset?{x:this.startCoords.page.x-o.x,y:this.startCoords.page.y-o.y}:a&&a.offset||{x:0,y:0};if(n&&a&&a.relativePoints&&a.relativePoints.length)for(var l=0;l<a.relativePoints.length;l++)this.snapOffsets.push({x:this.startOffset.left-r*a.relativePoints[l].x+p.x,y:this.startOffset.top-s*a.relativePoints[l].y+p.y});else this.snapOffsets.push(p);n&&h.elementRect?(this.restrictOffset.left=this.startOffset.left-r*h.elementRect.left,this.restrictOffset.top=this.startOffset.top-s*h.elementRect.top,this.restrictOffset.right=this.startOffset.right-r*(1-h.elementRect.right),this.restrictOffset.bottom=this.startOffset.bottom-s*(1-h.elementRect.bottom)):this.restrictOffset.left=this.restrictOffset.top=this.restrictOffset.right=this.restrictOffset.bottom=0},start:function(t,e,i){this.interacting()||!this.pointerIsDown||this.pointerIds.length<("gesture"===t.name?2:1)||(-1===jt(m,this)&&m.push(this),this.prepared.name||this.setEventXY(this.startCoords,this.pointers),this.prepared.name=t.name,this.prepared.axis=t.axis,this.prepared.edges=t.edges,this.target=e,this.element=i,this.setStartOffsets(t.name,e,i),this.setModifications(this.startCoords.page),this.prevEvent=this[this.prepared.name+"Start"](this.downEvent))},pointerMove:function(t,e,r,s,n){if(this.inertiaStatus.active){var o=this.inertiaStatus.upCoords.page,a=this.inertiaStatus.upCoords.client,h={pageX:o.x+this.inertiaStatus.sx,pageY:o.y+this.inertiaStatus.sy,clientX:a.x+this.inertiaStatus.sx,clientY:a.y+this.inertiaStatus.sy};this.setEventXY(this.curCoords,[h])}else this.recordPointer(t),this.setEventXY(this.curCoords,this.pointers);var p,l,c=this.curCoords.page.x===this.prevCoords.page.x&&this.curCoords.page.y===this.prevCoords.page.y&&this.curCoords.client.x===this.prevCoords.client.x&&this.curCoords.client.y===this.prevCoords.client.y,u=this.mouse?0:jt(this.pointerIds,pt(t));if(this.pointerIsDown&&!this.pointerWasMoved&&(p=this.curCoords.client.x-this.startCoords.client.x,l=this.curCoords.client.y-this.startCoords.client.y,this.pointerWasMoved=d(p,l)>z),c||this.pointerIsDown&&!this.pointerWasMoved||(this.pointerIsDown&&clearTimeout(this.holdTimers[u]),this.collectEventTargets(t,e,r,"move")),this.pointerIsDown)if(c&&this.pointerWasMoved&&!n)this.checkAndPreventDefault(e,this.target,this.element);else if(st(this.pointerDelta,this.prevCoords,this.curCoords),this.prepared.name){if(this.pointerWasMoved&&(!this.inertiaStatus.active||t instanceof Yt&&/inertiastart/.test(t.type))){if(!this.interacting()&&(st(this.pointerDelta,this.prevCoords,this.curCoords),"drag"===this.prepared.name)){var g=Math.abs(p),m=Math.abs(l),f=this.target.options.drag.axis,y=g>m?"x":g<m?"y":"xy";if("xy"!==y&&"xy"!==f&&f!==y){this.prepared.name=null;for(var x=r;$(x);){var E=v.get(x);if(E&&E!==this.target&&!E.options.drag.manualStart&&"drag"===E.getAction(this.downPointer,this.downEvent,this,x).name&&Mt(y,E)){this.prepared.name="drag",this.target=E,this.element=x;break}x=zt(x)}if(!this.prepared.name){var S=this,b=function(t,e,s){var n=i?s.querySelectorAll(e):void 0;if(t!==S.target)return Dt(t,r)&&!t.options.drag.manualStart&&!Tt(t,x,r)&&Ct(t,x,r)&&Kt(x,e,n)&&"drag"===t.getAction(S.downPointer,S.downEvent,S,x).name&&Mt(y,t)&&Ot(t,x,"drag")?t:void 0};for(x=r;$(x);){var w=v.forEachSelector(b);if(w){this.prepared.name="drag",this.target=w,this.element=x;break}x=zt(x)}}}}var D=!!this.prepared.name&&!this.interacting();if(D&&(this.target.options[this.prepared.name].manualStart||!Ot(this.target,this.element,this.prepared)))return void this.stop(e);if(this.prepared.name&&this.target)D&&this.start(this.prepared,this.target,this.element),(this.setModifications(this.curCoords.page,n)||D)&&(this.prevEvent=this[this.prepared.name+"Move"](e)),this.checkAndPreventDefault(e,this.target,this.element)}rt(this.prevCoords,this.curCoords),(this.dragging||this.resizing)&&this.autoScrollMove(t)}},dragStart:function(t){var e=new Yt(this,t,"drag","start",this.element);this.dragging=!0,this.target.fire(e),this.activeDrops.dropzones=[],this.activeDrops.elements=[],this.activeDrops.rects=[],this.dynamicDrop||this.setActiveDrops(this.element);var i=this.getDropEvents(t,e);return i.activate&&this.fireActiveDrops(i.activate),e},dragMove:function(t){var e=this.target,i=new Yt(this,t,"drag","move",this.element),r=this.element,s=this.getDrop(i,t,r);this.dropTarget=s.dropzone,this.dropElement=s.element;var n=this.getDropEvents(t,i);return e.fire(i),n.leave&&this.prevDropTarget.fire(n.leave),n.enter&&this.dropTarget.fire(n.enter),n.move&&this.dropTarget.fire(n.move),this.prevDropTarget=this.dropTarget,this.prevDropElement=this.dropElement,i},resizeStart:function(t){var e=new Yt(this,t,"resize","start",this.element);if(this.prepared.edges){var i=this.target.getRect(this.element);if(this.target.options.resize.square||this.target.options.resize.preserveAspectRatio){var r=et({},this.prepared.edges);r.top=r.top||r.left&&!r.bottom,r.left=r.left||r.top&&!r.right,r.bottom=r.bottom||r.right&&!r.top,r.right=r.right||r.bottom&&!r.left,this.prepared._linkedEdges=r}else this.prepared._linkedEdges=null;this.target.options.resize.preserveAspectRatio&&(this.resizeStartAspectRatio=i.width/i.height),this.resizeRects={start:i,current:et({},i),restricted:et({},i),previous:et({},i),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},e.rect=this.resizeRects.restricted,e.deltaRect=this.resizeRects.delta}return this.target.fire(e),this.resizing=!0,e},resizeMove:function(t){var e=new Yt(this,t,"resize","move",this.element),i=this.prepared.edges,r=this.target.options.resize.invert,s="reposition"===r||"negate"===r;if(i){var n,o=e.dx,a=e.dy,h=this.resizeRects.start,p=this.resizeRects.current,l=this.resizeRects.restricted,c=this.resizeRects.delta,d=et(this.resizeRects.previous,l),u=i;if(this.target.options.resize.preserveAspectRatio){var g=this.resizeStartAspectRatio;i=this.prepared._linkedEdges,u.left&&u.bottom||u.right&&u.top?a=-o/g:u.left||u.right?a=o/g:(u.top||u.bottom)&&(o=a*g)}else this.target.options.resize.square&&(i=this.prepared._linkedEdges,u.left&&u.bottom||u.right&&u.top?a=-o:u.left||u.right?a=o:(u.top||u.bottom)&&(o=a));if(i.top&&(p.top+=a),i.bottom&&(p.bottom+=a),i.left&&(p.left+=o),i.right&&(p.right+=o),s){if(et(l,p),"reposition"===r)l.top>l.bottom&&(n=l.top,l.top=l.bottom,l.bottom=n),l.left>l.right&&(n=l.left,l.left=l.right,l.right=n)}else l.top=Math.min(p.top,h.bottom),l.bottom=Math.max(p.bottom,h.top),l.left=Math.min(p.left,h.right),l.right=Math.max(p.right,h.left);for(var v in l.width=l.right-l.left,l.height=l.bottom-l.top,l)c[v]=l[v]-d[v];e.edges=this.prepared.edges,e.rect=l,e.deltaRect=c}return this.target.fire(e),e},gestureStart:function(t){var e=new Yt(this,t,"gesture","start",this.element);return e.ds=0,this.gesture.startDistance=this.gesture.prevDistance=e.distance,this.gesture.startAngle=this.gesture.prevAngle=e.angle,this.gesture.scale=1,this.gesturing=!0,this.target.fire(e),e},gestureMove:function(t){return this.pointerIds.length?((e=new Yt(this,t,"gesture","move",this.element)).ds=e.scale-this.gesture.scale,this.target.fire(e),this.gesture.prevAngle=e.angle,this.gesture.prevDistance=e.distance,e.scale===1/0||null===e.scale||void 0===e.scale||isNaN(e.scale)||(this.gesture.scale=e.scale),e):this.prevEvent;var e},pointerHold:function(t,e,i){this.collectEventTargets(t,e,i,"hold")},pointerUp:function(t,e,i,r){var s=this.mouse?0:jt(this.pointerIds,pt(t));clearTimeout(this.holdTimers[s]),this.collectEventTargets(t,e,i,"up"),this.collectEventTargets(t,e,i,"tap"),this.pointerEnd(t,e,i,r),this.removePointer(t)},pointerCancel:function(t,e,i,r){var s=this.mouse?0:jt(this.pointerIds,pt(t));clearTimeout(this.holdTimers[s]),this.collectEventTargets(t,e,i,"cancel"),this.pointerEnd(t,e,i,r),this.removePointer(t)},ie8Dblclick:function(t,e,i){this.prevTap&&e.clientX===this.prevTap.clientX&&e.clientY===this.prevTap.clientY&&i===this.prevTap.target&&(this.downTargets[0]=i,this.downTimes[0]=(new Date).getTime(),this.collectEventTargets(t,e,i,"tap"))},pointerEnd:function(t,e,i,r){var s,n=this.target,o=n&&n.options,a=o&&this.prepared.name&&o[this.prepared.name].inertia,h=this.inertiaStatus;if(this.interacting()){if(h.active&&!h.ending)return;var p,l,c,d=(new Date).getTime(),u=!1,g=Pt(n,this.prepared.name)&&o[this.prepared.name].snap.endOnly,v=At(n,this.prepared.name)&&o[this.prepared.name].restrict.endOnly,m=0,f=0;if(p=this.dragging?"x"===o.drag.axis?Math.abs(this.pointerDelta.client.vx):"y"===o.drag.axis?Math.abs(this.pointerDelta.client.vy):this.pointerDelta.client.speed:this.pointerDelta.client.speed,c=(l=a&&a.enabled&&"gesture"!==this.prepared.name&&e!==h.startEvent)&&d-this.curCoords.timeStamp<50&&p>a.minSpeed&&p>a.endSpeed,l&&!c&&(g||v)){var y={};y.snap=y.restrict=y,g&&(this.setSnapping(this.curCoords.page,y),y.locked&&(m+=y.dx,f+=y.dy)),v&&(this.setRestriction(this.curCoords.page,y),y.restricted&&(m+=y.dx,f+=y.dy)),(m||f)&&(u=!0)}if(c||u){if(rt(h.upCoords,this.curCoords),this.pointers[0]=h.startEvent=new Yt(this,e,this.prepared.name,"inertiastart",this.element),h.t0=d,n.fire(h.startEvent),c){h.vx0=this.pointerDelta.client.vx,h.vy0=this.pointerDelta.client.vy,h.v0=p,this.calcInertia(h);var x,E=et({},this.curCoords.page),S=xt(n,this.element);if(E.x=E.x+h.xe-S.x,E.y=E.y+h.ye-S.y,(x={useStatusXY:!0,x:E.x,y:E.y,dx:0,dy:0,snap:null}).snap=x,m=f=0,g){var b=this.setSnapping(this.curCoords.page,x);b.locked&&(m+=b.dx,f+=b.dy)}if(v){var w=this.setRestriction(this.curCoords.page,x);w.restricted&&(m+=w.dx,f+=w.dy)}h.modifiedXe+=m,h.modifiedYe+=f,h.i=Y(this.boundInertiaFrame)}else h.smoothEnd=!0,h.xe=m,h.ye=f,h.sx=h.sy=0,h.i=Y(this.boundSmoothEndFrame);return void(h.active=!0)}(g||v)&&this.pointerMove(t,e,i,r,!0)}if(this.dragging){s=new Yt(this,e,"drag","end",this.element);var z=this.element,D=this.getDrop(s,e,z);this.dropTarget=D.dropzone,this.dropElement=D.element;var T=this.getDropEvents(e,s);T.leave&&this.prevDropTarget.fire(T.leave),T.enter&&this.dropTarget.fire(T.enter),T.drop&&this.dropTarget.fire(T.drop),T.deactivate&&this.fireActiveDrops(T.deactivate),n.fire(s)}else this.resizing?(s=new Yt(this,e,"resize","end",this.element),n.fire(s)):this.gesturing&&(s=new Yt(this,e,"gesture","end",this.element),n.fire(s));this.stop(e)},collectDrops:function(t){var e,i=[],r=[];for(t=t||this.element,e=0;e<v.length;e++)if(v[e].options.drop.enabled){var s=v[e],n=s.options.drop.accept;if(!($(n)&&n!==t||Z(n)&&!Kt(t,n)))for(var o=s.selector?s._context.querySelectorAll(s.selector):[s._element],a=0,h=o.length;a<h;a++){var p=o[a];p!==t&&(i.push(s),r.push(p))}}return{dropzones:i,elements:r}},fireActiveDrops:function(t){var e,i,r,s;for(e=0;e<this.activeDrops.dropzones.length;e++)i=this.activeDrops.dropzones[e],(r=this.activeDrops.elements[e])!==s&&(t.target=r,i.fire(t)),s=r},setActiveDrops:function(t){var e=this.collectDrops(t,!0);this.activeDrops.dropzones=e.dropzones,this.activeDrops.elements=e.elements,this.activeDrops.rects=[];for(var i=0;i<this.activeDrops.dropzones.length;i++)this.activeDrops.rects[i]=this.activeDrops.dropzones[i].getRect(this.activeDrops.elements[i])},getDrop:function(t,e,i){var r=[];f&&this.setActiveDrops(i);for(var s=0;s<this.activeDrops.dropzones.length;s++){var n=this.activeDrops.dropzones[s],o=this.activeDrops.elements[s],p=this.activeDrops.rects[s];r.push(n.dropCheck(t,e,this.target,i,o,p)?o:null)}var c=function(t){var e,i,r,s,n,o=t[0],p=o?0:-1,c=[],d=[];for(s=1;s<t.length;s++)if((e=t[s])&&e!==o)if(o){if(e.parentNode!==e.ownerDocument)if(o.parentNode!==e.ownerDocument){if(!c.length)for(i=o;i.parentNode&&i.parentNode!==i.ownerDocument;)c.unshift(i),i=i.parentNode;if(o instanceof l&&e instanceof a&&!(e instanceof h)){if(e===o.parentNode)continue;i=e.ownerSVGElement}else i=e;for(d=[];i.parentNode!==i.ownerDocument;)d.unshift(i),i=i.parentNode;for(n=0;d[n]&&d[n]===c[n];)n++;var u=[d[n-1],d[n],c[n]];for(r=u[0].lastChild;r;){if(r===u[1]){o=e,p=s,c=[];break}if(r===u[2])break;r=r.previousSibling}}else o=e,p=s}else o=e,p=s;return p}(r);return{dropzone:this.activeDrops.dropzones[c]||null,element:this.activeDrops.elements[c]||null}},getDropEvents:function(t,e){var i={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return this.dropElement!==this.prevDropElement&&(this.prevDropTarget&&(i.leave={target:this.prevDropElement,dropzone:this.prevDropTarget,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,timeStamp:e.timeStamp,type:"dragleave"},e.dragLeave=this.prevDropElement,e.prevDropzone=this.prevDropTarget),this.dropTarget&&(i.enter={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,timeStamp:e.timeStamp,type:"dragenter"},e.dragEnter=this.dropElement,e.dropzone=this.dropTarget)),"dragend"===e.type&&this.dropTarget&&(i.drop={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,timeStamp:e.timeStamp,type:"drop"},e.dropzone=this.dropTarget),"dragstart"===e.type&&(i.activate={target:null,dropzone:null,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,timeStamp:e.timeStamp,type:"dropactivate"}),"dragend"===e.type&&(i.deactivate={target:null,dropzone:null,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,timeStamp:e.timeStamp,type:"dropdeactivate"}),"dragmove"===e.type&&this.dropTarget&&(i.move={target:this.dropElement,dropzone:this.dropTarget,relatedTarget:e.target,draggable:e.interactable,dragEvent:e,interaction:this,dragmove:e,timeStamp:e.timeStamp,type:"dropmove"},e.dropzone=this.dropTarget),i},currentAction:function(){return(this.dragging?"drag":this.resizing&&"resize")||this.gesturing&&"gesture"||null},interacting:function(){return this.dragging||this.resizing||this.gesturing},clearTargets:function(){this.target=this.element=null,this.dropTarget=this.dropElement=this.prevDropTarget=this.prevDropElement=null},stop:function(t){if(this.interacting()){E.stop(),this.matches=[],this.matchElements=[];var e=this.target;e.options.styleCursor&&(e._doc.documentElement.style.cursor=""),t&&K(t.preventDefault)&&this.checkAndPreventDefault(t,e,this.element),this.dragging&&(this.activeDrops.dropzones=this.activeDrops.elements=this.activeDrops.rects=null)}this.clearTargets(),this.pointerIsDown=this.snapStatus.locked=this.dragging=this.resizing=this.gesturing=!1,this.prepared.name=this.prevEvent=null,this.inertiaStatus.resumeDx=this.inertiaStatus.resumeDy=0;for(var i=0;i<this.pointers.length;i++)-1===jt(this.pointerIds,pt(this.pointers[i]))&&this.pointers.splice(i,1)},inertiaFrame:function(){var t,e,i,r,s,n,o,a=this.inertiaStatus,h=this.target.options[this.prepared.name].inertia.resistance,p=(new Date).getTime()/1e3-a.t0;if(p<a.te){var l=1-(Math.exp(-h*p)-a.lambda_v0)/a.one_ve_v0;if(a.modifiedXe===a.xe&&a.modifiedYe===a.ye)a.sx=a.xe*l,a.sy=a.ye*l;else{var c=(t=0,e=0,i=a.xe,r=a.ye,s=a.modifiedXe,n=a.modifiedYe,{x:Et(o=l,t,i,s),y:Et(o,e,r,n)});a.sx=c.x,a.sy=c.y}this.pointerMove(a.startEvent,a.startEvent),a.i=Y(this.boundInertiaFrame)}else a.ending=!0,a.sx=a.modifiedXe,a.sy=a.modifiedYe,this.pointerMove(a.startEvent,a.startEvent),this.pointerEnd(a.startEvent,a.startEvent),a.active=a.ending=!1},smoothEndFrame:function(){var t=this.inertiaStatus,e=(new Date).getTime()-t.t0,i=this.target.options[this.prepared.name].inertia.smoothEndDuration;e<i?(t.sx=St(e,0,t.xe,i),t.sy=St(e,0,t.ye,i),this.pointerMove(t.startEvent,t.startEvent),t.i=Y(this.boundSmoothEndFrame)):(t.ending=!0,t.sx=t.xe,t.sy=t.ye,this.pointerMove(t.startEvent,t.startEvent),this.pointerEnd(t.startEvent,t.startEvent),t.smoothEnd=t.active=t.ending=!1)},addPointer:function(t){var e=pt(t),i=this.mouse?0:jt(this.pointerIds,e);return-1===i&&(i=this.pointerIds.length),this.pointerIds[i]=e,this.pointers[i]=t,i},removePointer:function(t){var e=pt(t),i=this.mouse?0:jt(this.pointerIds,e);-1!==i&&(this.pointers.splice(i,1),this.pointerIds.splice(i,1),this.downTargets.splice(i,1),this.downTimes.splice(i,1),this.holdTimers.splice(i,1))},recordPointer:function(t){var e=this.mouse?0:jt(this.pointerIds,pt(t));-1!==e&&(this.pointers[e]=t)},collectEventTargets:function(t,e,r,s){var n=this.mouse?0:jt(this.pointerIds,pt(t));if("tap"!==s||!this.pointerWasMoved&&this.downTargets[n]&&this.downTargets[n]===r){for(var o=[],a=[],h=r;h;)Ut.isSet(h)&&Ut(h)._iEvents[s]&&(o.push(Ut(h)),a.push(h)),v.forEachSelector(p),h=zt(h);(o.length||"tap"===s)&&this.firePointers(t,e,r,o,a,s)}function p(t,e,n){var p=i?n.querySelectorAll(e):void 0;t._iEvents[s]&&$(h)&&Dt(t,h)&&!Tt(t,h,r)&&Ct(t,h,r)&&Kt(h,e,p)&&(o.push(t),a.push(h))}},firePointers:function(t,e,i,r,s,n){var o,a,h,p=this.mouse?0:jt(this.pointerIds,pt(t)),l={};for("doubletap"===n?l=t:(it(l,e),e!==t&&it(l,t),l.preventDefault=Rt,l.stopPropagation=Yt.prototype.stopPropagation,l.stopImmediatePropagation=Yt.prototype.stopImmediatePropagation,l.interaction=this,l.timeStamp=(new Date).getTime(),l.originalEvent=e,l.originalPointer=t,l.type=n,l.pointerId=pt(t),l.pointerType=this.mouse?"mouse":b?Z(t.pointerType)?t.pointerType:[,,"touch","pen","mouse"][t.pointerType]:"touch"),"tap"===n&&(l.dt=l.timeStamp-this.downTimes[p],a=l.timeStamp-this.tapTime,h=!!(this.prevTap&&"doubletap"!==this.prevTap.type&&this.prevTap.target===l.target&&a<500),l.double=h,this.tapTime=l.timeStamp),o=0;o<r.length&&(l.currentTarget=s[o],l.interactable=r[o],r[o].fire(l),!(l.immediatePropagationStopped||l.propagationStopped&&s[o+1]!==l.currentTarget));o++);if(h){var c={};et(c,l),c.dt=a,c.type="doubletap",this.collectEventTargets(c,e,i,"doubletap"),this.prevTap=c}else"tap"===n&&(this.prevTap=l)},validateSelector:function(t,e,i,r){for(var s=0,n=i.length;s<n;s++){var o=i[s],a=r[s],h=qt(o.getAction(t,e,this,a),o);if(h&&Ot(o,a,h))return this.target=o,this.element=a,h}},setSnapping:function(t,e){var i,r,s,n=this.target.options[this.prepared.name].snap,o=[];if((e=e||this.snapStatus).useStatusXY)r={x:e.x,y:e.y};else{var a=xt(this.target,this.element);(r=et({},t)).x-=a.x,r.y-=a.y}e.realX=r.x,e.realY=r.y,r.x=r.x-this.inertiaStatus.resumeDx,r.y=r.y-this.inertiaStatus.resumeDy;for(var h=n.targets?n.targets.length:0,p=0;p<this.snapOffsets.length;p++){var l={x:r.x-this.snapOffsets[p].x,y:r.y-this.snapOffsets[p].y};for(s=0;s<h;s++)(i=K(n.targets[s])?n.targets[s](l.x,l.y,this):n.targets[s])&&o.push({x:J(i.x)?i.x+this.snapOffsets[p].x:l.x,y:J(i.y)?i.y+this.snapOffsets[p].y:l.y,range:J(i.range)?i.range:n.range})}var c,u={target:null,inRange:!1,distance:0,range:0,dx:0,dy:0};for(s=0,h=o.length;s<h;s++){var g=(i=o[s]).range,v=i.x-r.x,m=i.y-r.y,f=d(v,m),y=f<=g;g===1/0&&u.inRange&&u.range!==1/0&&(y=!1),u.target&&!(y?u.inRange&&g!==1/0?f/g<u.distance/u.range:g===1/0&&u.range!==1/0||f<u.distance:!u.inRange&&f<u.distance)||(g===1/0&&(y=!0),u.target=i,u.distance=f,u.range=g,u.inRange=y,u.dx=v,u.dy=m,e.range=g)}return u.target?(c=e.snappedX!==u.target.x||e.snappedY!==u.target.y,e.snappedX=u.target.x,e.snappedY=u.target.y):(c=!0,e.snappedX=NaN,e.snappedY=NaN),e.dx=u.dx,e.dy=u.dy,e.changed=c||u.inRange&&!e.locked,e.locked=u.inRange,e},setRestriction:function(t,e){var i,r,s,n,o=this.target,a=o&&o.options[this.prepared.name].restrict,h=a&&a.restriction;return h?(i=i=(e=e||this.restrictStatus).useStatusXY?{x:e.x,y:e.y}:et({},t),e.snap&&e.snap.locked&&(i.x+=e.snap.dx||0,i.y+=e.snap.dy||0),i.x-=this.inertiaStatus.resumeDx,i.y-=this.inertiaStatus.resumeDy,e.dx=0,e.dy=0,e.restricted=!1,Z(h)&&!(h="parent"===h?zt(this.element):"self"===h?o.getRect(this.element):wt(this.element,h))?e:(K(h)&&(h=h(i.x,i.y,this.element)),$(h)&&(h=ut(h)),r=h,h?"x"in h&&"y"in h?(s=Math.max(Math.min(r.x+r.width-this.restrictOffset.right,i.x),r.x+this.restrictOffset.left),n=Math.max(Math.min(r.y+r.height-this.restrictOffset.bottom,i.y),r.y+this.restrictOffset.top)):(s=Math.max(Math.min(r.right-this.restrictOffset.right,i.x),r.left+this.restrictOffset.left),n=Math.max(Math.min(r.bottom-this.restrictOffset.bottom,i.y),r.top+this.restrictOffset.top)):(s=i.x,n=i.y),e.dx=s-i.x,e.dy=n-i.y,e.changed=e.restrictedX!==s||e.restrictedY!==n,e.restricted=!(!e.dx&&!e.dy),e.restrictedX=s,e.restrictedY=n,e)):e},checkAndPreventDefault:function(t,e,i){if(e=e||this.target){var r=e.options,s=r.preventDefault;if("auto"!==s||!i||/^(input|select|textarea)$/i.test(t.target.nodeName))"always"!==s||t.preventDefault();else{if(/down|start/i.test(t.type)&&"drag"===this.prepared.name&&"xy"!==r.drag.axis)return;if(r[this.prepared.name]&&r[this.prepared.name].manualStart&&!this.interacting())return;t.preventDefault()}}},calcInertia:function(t){var e=this.target.options[this.prepared.name].inertia,i=e.resistance,r=-Math.log(e.endSpeed/t.v0)/i;t.x0=this.prevEvent.pageX,t.y0=this.prevEvent.pageY,t.t0=t.startEvent.timeStamp/1e3,t.sx=t.sy=0,t.modifiedXe=t.xe=(t.vx0-r)/i,t.modifiedYe=t.ye=(t.vy0-r)/i,t.te=r,t.lambda_v0=i/t.v0,t.one_ve_v0=1-e.endSpeed/t.v0},autoScrollMove:function(t){var e,i,r;if(this.interacting()&&(e=this.target,i=this.prepared.name,r=e.options,/^resize/.test(i)&&(i="resize"),r[i].autoScroll&&r[i].autoScroll.enabled))if(this.inertiaStatus.active)E.x=E.y=0;else{var s,n,o,a,h=this.target.options[this.prepared.name].autoScroll,p=h.container||ct(this.element);if(G(p))a=t.clientX<E.margin,s=t.clientY<E.margin,n=t.clientX>p.innerWidth-E.margin,o=t.clientY>p.innerHeight-E.margin;else{var l=dt(p);a=t.clientX<l.left+E.margin,s=t.clientY<l.top+E.margin,n=t.clientX>l.right-E.margin,o=t.clientY>l.bottom-E.margin}E.x=n?1:a?-1:0,E.y=o?1:s?-1:0,E.isScrolling||(E.margin=h.margin,E.speed=h.speed,E.start(this))}},_updateEventTargets:function(t,e){this._eventTarget=t,this._curEventTarget=e}},Yt.prototype={preventDefault:V,stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},stopPropagation:function(){this.propagationStopped=!0}};for(var N={},q=["dragStart","dragMove","resizeStart","resizeMove","gestureStart","gestureMove","pointerOver","pointerOut","pointerHover","selectorDown","pointerDown","pointerMove","pointerUp","pointerCancel","pointerEnd","addPointer","removePointer","recordPointer","autoScrollMove"],H=0,W=q.length;H<W;H++){var U=q[H];N[U]=Xt(U)}v.indexOfElement=function(t,e){e=e||n;for(var i=0;i<this.length;i++){var r=this[i];if(r.selector===t&&r._context===e||!r.selector&&r._element===t)return i}return-1},v.get=function(t,e){return this[this.indexOfElement(t,e&&e.context)]},v.forEachSelector=function(t){for(var e=0;e<this.length;e++){var i=this[e];if(i.selector){var r=t(i,i.selector,i._context,e,this);if(void 0!==r)return r}}},Vt.prototype={setOnEvents:function(t,e){return"drop"===t?(K(e.ondrop)&&(this.ondrop=e.ondrop),K(e.ondropactivate)&&(this.ondropactivate=e.ondropactivate),K(e.ondropdeactivate)&&(this.ondropdeactivate=e.ondropdeactivate),K(e.ondragenter)&&(this.ondragenter=e.ondragenter),K(e.ondragleave)&&(this.ondragleave=e.ondragleave),K(e.ondropmove)&&(this.ondropmove=e.ondropmove)):(t="on"+t,K(e.onstart)&&(this[t+"start"]=e.onstart),K(e.onmove)&&(this[t+"move"]=e.onmove),K(e.onend)&&(this[t+"end"]=e.onend),K(e.oninertiastart)&&(this[t+"inertiastart"]=e.oninertiastart)),this},draggable:function(t){return B(t)?(this.options.drag.enabled=!1!==t.enabled,this.setPerAction("drag",t),this.setOnEvents("drag",t),/^x$|^y$|^xy$/.test(t.axis)?this.options.drag.axis=t.axis:null===t.axis&&delete this.options.drag.axis,this):Q(t)?(this.options.drag.enabled=t,this):this.options.drag},setPerAction:function(t,e){for(var i in e)i in x[t]&&(B(e[i])?(this.options[t][i]=et(this.options[t][i]||{},e[i]),B(x.perAction[i])&&"enabled"in x.perAction[i]&&(this.options[t][i].enabled=!1!==e[i].enabled)):Q(e[i])&&B(x.perAction[i])?this.options[t][i].enabled=e[i]:void 0!==e[i]&&(this.options[t][i]=e[i]))},dropzone:function(t){return B(t)?(this.options.drop.enabled=!1!==t.enabled,this.setOnEvents("drop",t),/^(pointer|center)$/.test(t.overlap)?this.options.drop.overlap=t.overlap:J(t.overlap)&&(this.options.drop.overlap=Math.max(Math.min(1,t.overlap),0)),"accept"in t&&(this.options.drop.accept=t.accept),"checker"in t&&(this.options.drop.checker=t.checker),this):Q(t)?(this.options.drop.enabled=t,this):this.options.drop},dropCheck:function(t,e,i,r,s,n){var o=!1;if(!(n=n||this.getRect(s)))return!!this.options.drop.checker&&this.options.drop.checker(t,e,o,this,s,i,r);var a=this.options.drop.overlap;if("pointer"===a){var h,p,l=at(t),c=xt(i,r);l.x+=c.x,l.y+=c.y,h=l.x>n.left&&l.x<n.right,p=l.y>n.top&&l.y<n.bottom,o=h&&p}var d=i.getRect(r);if("center"===a){var u=d.left+d.width/2,g=d.top+d.height/2;o=u>=n.left&&u<=n.right&&g>=n.top&&g<=n.bottom}J(a)&&(o=Math.max(0,Math.min(n.right,d.right)-Math.max(n.left,d.left))*Math.max(0,Math.min(n.bottom,d.bottom)-Math.max(n.top,d.top))/(d.width*d.height)>=a);return this.options.drop.checker&&(o=this.options.drop.checker(t,e,o,this,s,i,r)),o},dropChecker:function(t){return K(t)?(this.options.drop.checker=t,this):null===t?(delete this.options.getRect,this):this.options.drop.checker},accept:function(t){return $(t)?(this.options.drop.accept=t,this):tt(t)?(this.options.drop.accept=t,this):null===t?(delete this.options.drop.accept,this):this.options.drop.accept},resizable:function(t){return B(t)?(this.options.resize.enabled=!1!==t.enabled,this.setPerAction("resize",t),this.setOnEvents("resize",t),/^x$|^y$|^xy$/.test(t.axis)?this.options.resize.axis=t.axis:null===t.axis&&(this.options.resize.axis=x.resize.axis),Q(t.preserveAspectRatio)?this.options.resize.preserveAspectRatio=t.preserveAspectRatio:Q(t.square)&&(this.options.resize.square=t.square),this):Q(t)?(this.options.resize.enabled=t,this):this.options.resize},squareResize:function(t){return Q(t)?(this.options.resize.square=t,this):null===t?(delete this.options.resize.square,this):this.options.resize.square},gesturable:function(t){return B(t)?(this.options.gesture.enabled=!1!==t.enabled,this.setPerAction("gesture",t),this.setOnEvents("gesture",t),this):Q(t)?(this.options.gesture.enabled=t,this):this.options.gesture},autoScroll:function(t){return B(t)?t=et({actions:["drag","resize"]},t):Q(t)&&(t={actions:["drag","resize"],enabled:t}),this.setOptions("autoScroll",t)},snap:function(t){var e=this.setOptions("snap",t);return e===this?this:e.drag},setOptions:function(t,e){var i,r=e&&j(e.actions)?e.actions:["drag"];if(B(e)||Q(e)){for(i=0;i<r.length;i++){var s=/resize/.test(r[i])?"resize":r[i];if(B(this.options[s])){var n=this.options[s][t];B(e)?(et(n,e),n.enabled=!1!==e.enabled,"snap"===t&&("grid"===n.mode?n.targets=[Ut.createSnapGrid(et({offset:n.gridOffset||{x:0,y:0}},n.grid||{}))]:"anchor"===n.mode?n.targets=n.anchors:"path"===n.mode&&(n.targets=n.paths),"elementOrigin"in e&&(n.relativePoints=[e.elementOrigin]))):Q(e)&&(n.enabled=e)}}return this}var o={},a=["drag","resize","gesture"];for(i=0;i<a.length;i++)t in x[a[i]]&&(o[a[i]]=this.options[a[i]][t]);return o},inertia:function(t){var e=this.setOptions("inertia",t);return e===this?this:e.drag},getAction:function(t,e,i,r){var s=this.defaultActionChecker(t,i,r);return this.options.actionChecker?this.options.actionChecker(t,e,s,this,r,i):s},defaultActionChecker:Nt,actionChecker:function(t){return K(t)?(this.options.actionChecker=t,this):null===t?(delete this.options.actionChecker,this):this.options.actionChecker},getRect:function(t){return t=t||this._element,this.selector&&!$(t)&&(t=this._context.querySelector(this.selector)),ut(t)},rectChecker:function(t){return K(t)?(this.getRect=t,this):null===t?(delete this.options.getRect,this):this.getRect},styleCursor:function(t){return Q(t)?(this.options.styleCursor=t,this):null===t?(delete this.options.styleCursor,this):this.options.styleCursor},preventDefault:function(t){return/^(always|never|auto)$/.test(t)?(this.options.preventDefault=t,this):Q(t)?(this.options.preventDefault=t?"always":"never",this):this.options.preventDefault},origin:function(t){return tt(t)?(this.options.origin=t,this):B(t)?(this.options.origin=t,this):this.options.origin},deltaSource:function(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource},restrict:function(t){if(!B(t))return this.setOptions("restrict",t);for(var e,i=["drag","resize","gesture"],r=0;r<i.length;r++){var s=i[r];if(s in t){var n=et({actions:[s],restriction:t[s]},t);e=this.setOptions("restrict",n)}}return e},context:function(){return this._context},_context:n,ignoreFrom:function(t){return tt(t)?(this.options.ignoreFrom=t,this):$(t)?(this.options.ignoreFrom=t,this):this.options.ignoreFrom},allowFrom:function(t){return tt(t)?(this.options.allowFrom=t,this):$(t)?(this.options.allowFrom=t,this):this.options.allowFrom},element:function(){return this._element},fire:function(t){if(!t||!t.type||!Bt(A,t.type))return this;var e,i,r,s="on"+t.type;if(t.type in this._iEvents)for(i=0,r=(e=this._iEvents[t.type]).length;i<r&&!t.immediatePropagationStopped;i++)e[i].name,e[i](t);if(K(this[s])&&(this[s].name,this[s](t)),t.type in O&&(e=O[t.type]))for(i=0,r=e.length;i<r&&!t.immediatePropagationStopped;i++)e[i].name,e[i](t);return this},on:function(t,e,i){var r;if(Z(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),j(t)){for(r=0;r<t.length;r++)this.on(t[r],e,i);return this}if(B(t)){for(var s in t)this.on(s,t[s],e);return this}if("wheel"===t&&(t=P),i=!!i,Bt(A,t))t in this._iEvents?this._iEvents[t].push(e):this._iEvents[t]=[e];else if(this.selector){if(!y[t])for(y[t]={selectors:[],contexts:[],listeners:[]},r=0;r<g.length;r++)I.add(g[r],t,Ht),I.add(g[r],t,Wt,!0);var n,o=y[t];for(n=o.selectors.length-1;n>=0&&(o.selectors[n]!==this.selector||o.contexts[n]!==this._context);n--);-1===n&&(n=o.selectors.length,o.selectors.push(this.selector),o.contexts.push(this._context),o.listeners.push([])),o.listeners[n].push([e,i])}else I.add(this._element,t,e,i);return this},off:function(t,e,i){var r;if(Z(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),j(t)){for(r=0;r<t.length;r++)this.off(t[r],e,i);return this}if(B(t)){for(var s in t)this.off(s,t[s],e);return this}var n,o=-1;if(i=!!i,"wheel"===t&&(t=P),Bt(A,t))(n=this._iEvents[t])&&-1!==(o=jt(n,e))&&this._iEvents[t].splice(o,1);else if(this.selector){var a=y[t],h=!1;if(!a)return this;for(o=a.selectors.length-1;o>=0;o--)if(a.selectors[o]===this.selector&&a.contexts[o]===this._context){var p=a.listeners[o];for(r=p.length-1;r>=0;r--){var l=p[r][0],c=p[r][1];if(l===e&&c===i){p.splice(r,1),p.length||(a.selectors.splice(o,1),a.contexts.splice(o,1),a.listeners.splice(o,1),I.remove(this._context,t,Ht),I.remove(this._context,t,Wt,!0),a.selectors.length||(y[t]=null)),h=!0;break}}if(h)break}}else I.remove(this._element,t,e,i);return this},set:function(t){B(t)||(t={}),this.options=et({},x.base);var e,i=["drag","drop","resize","gesture"],r=["draggable","dropzone","resizable","gesturable"],s=et(et({},x.perAction),t[n]||{});for(e=0;e<i.length;e++){var n=i[e];this.options[n]=et({},x[n]),this.setPerAction(n,s),this[r[e]](t[n])}var o=["accept","actionChecker","allowFrom","deltaSource","dropChecker","ignoreFrom","origin","preventDefault","rectChecker","styleCursor"];for(e=0,W=o.length;e<W;e++){var a=o[e];this.options[a]=x.base[a],a in t&&this[a](t[a])}return this},unset:function(){if(I.remove(this._element,"all"),Z(this.selector))for(var t in y)for(var e=y[t],i=0;i<e.selectors.length;i++){e.selectors[i]===this.selector&&e.contexts[i]===this._context&&(e.selectors.splice(i,1),e.contexts.splice(i,1),e.listeners.splice(i,1),e.selectors.length||(y[t]=null)),I.remove(this._context,t,Ht),I.remove(this._context,t,Wt,!0);break}else I.remove(this,"all"),this.options.styleCursor&&(this._element.style.cursor="");return this.dropzone(!1),v.splice(jt(v,this),1),Ut}},Vt.prototype.snap=$t(Vt.prototype.snap,"Interactable#snap is deprecated. See the new documentation for snapping at http://interactjs.io/docs/snapping"),Vt.prototype.restrict=$t(Vt.prototype.restrict,"Interactable#restrict is deprecated. See the new documentation for resticting at http://interactjs.io/docs/restriction"),Vt.prototype.inertia=$t(Vt.prototype.inertia,"Interactable#inertia is deprecated. See the new documentation for inertia at http://interactjs.io/docs/inertia"),Vt.prototype.autoScroll=$t(Vt.prototype.autoScroll,"Interactable#autoScroll is deprecated. See the new documentation for autoScroll at http://interactjs.io/docs/#autoscroll"),Vt.prototype.squareResize=$t(Vt.prototype.squareResize,"Interactable#squareResize is deprecated. See http://interactjs.io/docs/#resize-square"),Vt.prototype.accept=$t(Vt.prototype.accept,"Interactable#accept is deprecated. use Interactable#dropzone({ accept: target }) instead"),Vt.prototype.dropChecker=$t(Vt.prototype.dropChecker,"Interactable#dropChecker is deprecated. use Interactable#dropzone({ dropChecker: checkerFunction }) instead"),Vt.prototype.context=$t(Vt.prototype.context,"Interactable#context as a method is deprecated. It will soon be a DOM Node instead"),Ut.isSet=function(t,e){return-1!==v.indexOfElement(t,e&&e.context)},Ut.on=function(t,e,i){if(Z(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),j(t)){for(var r=0;r<t.length;r++)Ut.on(t[r],e,i);return Ut}if(B(t)){for(var s in t)Ut.on(s,t[s],e);return Ut}return Bt(A,t)?O[t]?O[t].push(e):O[t]=[e]:I.add(n,t,e,i),Ut},Ut.off=function(t,e,i){if(Z(t)&&-1!==t.search(" ")&&(t=t.trim().split(/ +/)),j(t)){for(var r=0;r<t.length;r++)Ut.off(t[r],e,i);return Ut}if(B(t)){for(var s in t)Ut.off(s,t[s],e);return Ut}var o;Bt(A,t)?t in O&&-1!==(o=jt(O[t],e))&&O[t].splice(o,1):I.remove(n,t,e,i);return Ut},Ut.enableDragging=$t(function(t){return null!=t?(M.drag=t,Ut):M.drag},"interact.enableDragging is deprecated and will soon be removed."),Ut.enableResizing=$t(function(t){return null!=t?(M.resize=t,Ut):M.resize},"interact.enableResizing is deprecated and will soon be removed."),Ut.enableGesturing=$t(function(t){return null!=t?(M.gesture=t,Ut):M.gesture},"interact.enableGesturing is deprecated and will soon be removed."),Ut.eventTypes=A,Ut.debug=function(){var t=m[0]||new _t;return{interactions:m,target:t.target,dragging:t.dragging,resizing:t.resizing,gesturing:t.gesturing,prepared:t.prepared,matches:t.matches,matchElements:t.matchElements,prevCoords:t.prevCoords,startCoords:t.startCoords,pointerIds:t.pointerIds,pointers:t.pointers,addPointer:N.addPointer,removePointer:N.removePointer,recordPointer:N.recordPointer,snap:t.snapStatus,restrict:t.restrictStatus,inertia:t.inertiaStatus,downTime:t.downTimes[0],downEvent:t.downEvent,downPointer:t.downPointer,prevEvent:t.prevEvent,Interactable:Vt,interactables:v,pointerIsDown:t.pointerIsDown,defaultOptions:x,defaultActionChecker:Nt,actionCursors:C,dragMove:N.dragMove,resizeMove:N.resizeMove,gestureMove:N.gestureMove,pointerUp:N.pointerUp,pointerDown:N.pointerDown,pointerMove:N.pointerMove,pointerHover:N.pointerHover,eventTypes:A,events:I,globalEvents:O,delegatedEvents:y,prefixedPropREs:F}},Ut.getPointerAverage=vt,Ut.getTouchBBox=mt,Ut.getTouchDistance=ft,Ut.getTouchAngle=yt,Ut.getElementRect=ut,Ut.getElementClientRect=dt,Ut.matchesSelector=Kt,Ut.closest=wt,Ut.margin=$t(function(t){return J(t)?(w=t,Ut):w},"interact.margin is deprecated. Use interact(target).resizable({ margin: number }); instead."),Ut.supportsTouch=function(){return S},Ut.supportsPointerEvent=function(){return b},Ut.stop=function(t){for(var e=m.length-1;e>=0;e--)m[e].stop(t);return Ut},Ut.dynamicDrop=function(t){return Q(t)?(f=t,Ut):f},Ut.pointerMoveTolerance=function(t){return J(t)?(z=t,this):z},Ut.maxInteractions=function(t){return J(t)?(T=t,this):T},Ut.createSnapGrid=function(t){return function(e,i){var r=0,s=0;B(t.offset)&&(r=t.offset.x,s=t.offset.y);var n=Math.round((e-r)/t.x),o=Math.round((i-s)/t.y);return{x:n*t.x+r,y:o*t.y+s,range:t.range}}},Lt(n),X in Element.prototype&&K(Element.prototype[X])||(i=function(t,e,i){for(var r=0,s=(i=i||t.parentNode.querySelectorAll(e)).length;r<s;r++)if(i[r]===t)return!0;return!1}),function(){for(var e=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!t.requestAnimationFrame;++r)Y=t[i[r]+"RequestAnimationFrame"],R=t[i[r]+"CancelAnimationFrame"]||t[i[r]+"CancelRequestAnimationFrame"];Y||(Y=function(t){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),s=setTimeout(function(){t(i+r)},r);return e=i+r,s}),R||(R=function(t){clearTimeout(t)})}(),t.interact=Ut}function V(){}function $(t){if(!t||"object"!=typeof t)return!1;var e=ct(t)||s;return/object|function/.test(typeof e.Element)?t instanceof e.Element:1===t.nodeType&&"string"==typeof t.nodeName}function G(t){return t===s||!(!t||!t.Window)&&t instanceof t.Window}function L(t){return!!t&&t instanceof o}function j(t){return B(t)&&void 0!==typeof t.length&&K(t.splice)}function B(t){return!!t&&"object"==typeof t}function K(t){return"function"==typeof t}function J(t){return"number"==typeof t}function Q(t){return"boolean"==typeof t}function Z(t){return"string"==typeof t}function tt(t){return!!Z(t)&&(n.querySelector(t),!0)}function et(t,e){for(var i in e)t[i]=e[i];return t}function it(t,e){for(var i in e){var r=!1;for(var s in F)if(0===i.indexOf(s)&&F[s].test(i)){r=!0;break}r||(t[i]=e[i])}return t}function rt(t,e){t.page=t.page||{},t.page.x=e.page.x,t.page.y=e.page.y,t.client=t.client||{},t.client.x=e.client.x,t.client.y=e.client.y,t.timeStamp=e.timeStamp}function st(t,e,i){t.page.x=i.page.x-e.page.x,t.page.y=i.page.y-e.page.y,t.client.x=i.client.x-e.client.x,t.client.y=i.client.y-e.client.y,t.timeStamp=(new Date).getTime()-e.timeStamp;var r=Math.max(t.timeStamp/1e3,.001);t.page.speed=d(t.page.x,t.page.y)/r,t.page.vx=t.page.x/r,t.page.vy=t.page.y/r,t.client.speed=d(t.client.x,t.page.y)/r,t.client.vx=t.client.x/r,t.client.vy=t.client.y/r}function nt(t){return t instanceof s.Event||S&&s.Touch&&t instanceof s.Touch}function ot(t,e,i){return t=t||"page",(i=i||{}).x=e[t+"X"],i.y=e[t+"Y"],i}function at(t,e){return e=e||{},_&&nt(t)?(ot("screen",t,e),e.x+=s.scrollX,e.y+=s.scrollY):ot("page",t,e),e}function ht(t,e){return e=e||{},_&&nt(t)?ot("screen",t,e):ot("client",t,e),e}function pt(t){return J(t.pointerId)?t.pointerId:t.identifier}function lt(t){return t instanceof p?t.correspondingUseElement:t}function ct(t){if(G(t))return t;var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||s}function dt(t){var e=t instanceof a?t.getBoundingClientRect():t.getClientRects()[0];return e&&{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top}}function ut(t){var e,i=dt(t);if(!k&&i){var r={x:(e=(e=ct(t))||s).scrollX||e.document.documentElement.scrollLeft,y:e.scrollY||e.document.documentElement.scrollTop};i.left+=r.x,i.right+=r.x,i.top+=r.y,i.bottom+=r.y}return i}function gt(t){var e=[];return j(t)?(e[0]=t[0],e[1]=t[1]):"touchend"===t.type?1===t.touches.length?(e[0]=t.touches[0],e[1]=t.changedTouches[0]):0===t.touches.length&&(e[0]=t.changedTouches[0],e[1]=t.changedTouches[1]):(e[0]=t.touches[0],e[1]=t.touches[1]),e}function vt(t){for(var e,i={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},r=0;r<t.length;r++)for(e in i)i[e]+=t[r][e];for(e in i)i[e]/=t.length;return i}function mt(t){if(t.length||t.touches&&t.touches.length>1){var e=gt(t),i=Math.min(e[0].pageX,e[1].pageX),r=Math.min(e[0].pageY,e[1].pageY);return{x:i,y:r,left:i,top:r,width:Math.max(e[0].pageX,e[1].pageX)-i,height:Math.max(e[0].pageY,e[1].pageY)-r}}}function ft(t,e){var i=(e=e||x.deltaSource)+"X",r=e+"Y",s=gt(t),n=s[0][i]-s[1][i],o=s[0][r]-s[1][r];return d(n,o)}function yt(t,e,i){var r=(i=i||x.deltaSource)+"X",s=i+"Y",n=gt(t),o=n[0][r]-n[1][r],a=n[0][s]-n[1][s],h=180*Math.atan(a/o)/Math.PI;if(J(e)){var p=(h-e)%360;p>315?h-=360+h/360|0:p>135?h-=180+h/360|0:p<-315?h+=360+h/360|0:p<-135&&(h+=180+h/360|0)}return h}function xt(t,e){var i=t?t.options.origin:x.origin;return"parent"===i?i=zt(e):"self"===i?i=t.getRect(e):tt(i)&&(i=wt(e,i)||{x:0,y:0}),K(i)&&(i=i(t&&e)),$(i)&&(i=ut(i)),i.x="x"in i?i.x:i.left,i.y="y"in i?i.y:i.top,i}function Et(t,e,i,r){var s=1-t;return s*s*e+2*s*t*i+t*t*r}function St(t,e,i,r){return-i*(t/=r)*(t-2)+e}function bt(t,e){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function wt(t,e){for(var i=zt(t);$(i);){if(Kt(i,e))return i;i=zt(i)}return null}function zt(t){var e=t.parentNode;if(L(e)){for(;(e=e.host)&&L(e););return e}return e}function Dt(t,e){return t._context===e.ownerDocument||bt(t._context,e)}function Tt(t,e,i){var r=t.options.ignoreFrom;return!(!r||!$(i))&&(Z(r)?Jt(i,r,e):!!$(r)&&bt(r,i))}function Ct(t,e,i){var r=t.options.allowFrom;return!r||!!$(i)&&(Z(r)?Jt(i,r,e):!!$(r)&&bt(r,i))}function Mt(t,e){if(!e)return!1;var i=e.options.drag.axis;return"xy"===t||"xy"===i||i===t}function Pt(t,e){var i=t.options;return/^resize/.test(e)&&(e="resize"),i[e].snap&&i[e].snap.enabled}function At(t,e){var i=t.options;return/^resize/.test(e)&&(e="resize"),i[e].restrict&&i[e].restrict.enabled}function Ot(t,e,i){for(var r=t.options,s=r[i.name].max,n=r[i.name].maxPerElement,o=0,a=0,h=0,p=0,l=m.length;p<l;p++){var c=m[p],d=c.prepared.name;if(c.interacting()){if(++o>=T)return!1;if(c.target===t){if((a+=d===i.name|0)>=s)return!1;if(c.element===e&&(h++,d!==i.name||h>=n))return!1}}}return T>0}function _t(){if(this.target=null,this.element=null,this.dropTarget=null,this.dropElement=null,this.prevDropTarget=null,this.prevDropElement=null,this.prepared={name:null,axis:null,edges:null},this.matches=[],this.matchElements=[],this.inertiaStatus={active:!1,smoothEnd:!1,ending:!1,startEvent:null,upCoords:{},xe:0,ye:0,sx:0,sy:0,t0:0,vx0:0,vys:0,duration:0,resumeDx:0,resumeDy:0,lambda_v0:0,one_ve_v0:0,i:null},K(Function.prototype.bind))this.boundInertiaFrame=this.inertiaFrame.bind(this),this.boundSmoothEndFrame=this.smoothEndFrame.bind(this);else{var t=this;this.boundInertiaFrame=function(){return t.inertiaFrame()},this.boundSmoothEndFrame=function(){return t.smoothEndFrame()}}this.activeDrops={dropzones:[],elements:[],rects:[]},this.pointers=[],this.pointerIds=[],this.downTargets=[],this.downTimes=[],this.holdTimers=[],this.prevCoords={page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},this.curCoords={page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},this.startCoords={page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},this.pointerDelta={page:{x:0,y:0,vx:0,vy:0,speed:0},client:{x:0,y:0,vx:0,vy:0,speed:0},timeStamp:0},this.downEvent=null,this.downPointer={},this._eventTarget=null,this._curEventTarget=null,this.prevEvent=null,this.tapTime=0,this.prevTap=null,this.startOffset={left:0,right:0,top:0,bottom:0},this.restrictOffset={left:0,right:0,top:0,bottom:0},this.snapOffsets=[],this.gesture={start:{x:0,y:0},startDistance:0,prevDistance:0,distance:0,scale:1,startAngle:0,prevAngle:0},this.snapStatus={x:0,y:0,dx:0,dy:0,realX:0,realY:0,snappedX:0,snappedY:0,targets:[],locked:!1,changed:!1},this.restrictStatus={dx:0,dy:0,restrictedX:0,restrictedY:0,snap:null,restricted:!1,changed:!1},this.restrictStatus.snap=this.snapStatus,this.pointerIsDown=!1,this.pointerWasMoved=!1,this.gesturing=!1,this.dragging=!1,this.resizing=!1,this.resizeAxes="xy",this.mouse=!1,m.push(this)}function kt(t,e,i){var r,s=0,n=m.length,o=/mouse/i.test(t.pointerType||e)||4===t.pointerType,a=pt(t);if(/down|start/i.test(e))for(s=0;s<n;s++){var h=i;if((r=m[s]).inertiaStatus.active&&r.target.options[r.prepared.name].inertia.allowResume&&r.mouse===o)for(;h;){if(h===r.element)return r;h=zt(h)}}if(o||!S&&!b){for(s=0;s<n;s++)if(m[s].mouse&&!m[s].inertiaStatus.active)return m[s];for(s=0;s<n;s++)if(m[s].mouse&&(!/down/.test(e)||!m[s].inertiaStatus.active))return r;return(r=new _t).mouse=!0,r}for(s=0;s<n;s++)if(Bt(m[s].pointerIds,a))return m[s];if(/up|end|out/i.test(e))return null;for(s=0;s<n;s++)if((!(r=m[s]).prepared.name||r.target.options.gesture.enabled)&&!r.interacting()&&(o||!r.mouse))return r;return new _t}function Xt(t){return function(e){var i,r,s=lt(e.path?e.path[0]:e.target),n=lt(e.currentTarget);if(S&&/touch/.test(e.type))for(D=(new Date).getTime(),r=0;r<e.changedTouches.length;r++){var o=e.changedTouches[r];(i=kt(o,e.type,s))&&(i._updateEventTargets(s,n),i[t](o,e,s,n))}else{if(!b&&/mouse/.test(e.type)){for(r=0;r<m.length;r++)if(!m[r].mouse&&m[r].pointerIsDown)return;if((new Date).getTime()-D<500)return}if(!(i=kt(e,e.type,s)))return;i._updateEventTargets(s,n),i[t](e,e,s,n)}}}function Yt(t,e,i,r,s,n){var o,a,h=t.target,p=t.snapStatus,l=t.restrictStatus,c=t.pointers,u=(h&&h.options||x).deltaSource,g=u+"X",v=u+"Y",m=h?h.options:x,f=xt(h,s),y="start"===r,E="end"===r,S=y?t.startCoords:t.curCoords;s=s||t.element,a=et({},S.page),o=et({},S.client),a.x-=f.x,a.y-=f.y,o.x-=f.x,o.y-=f.y;var b=m[i].snap&&m[i].snap.relativePoints;!Pt(h,i)||y&&b&&b.length||(this.snap={range:p.range,locked:p.locked,x:p.snappedX,y:p.snappedY,realX:p.realX,realY:p.realY,dx:p.dx,dy:p.dy},p.locked&&(a.x+=p.dx,a.y+=p.dy,o.x+=p.dx,o.y+=p.dy)),!At(h,i)||y&&m[i].restrict.elementRect||!l.restricted||(a.x+=l.dx,a.y+=l.dy,o.x+=l.dx,o.y+=l.dy,this.restrict={dx:l.dx,dy:l.dy}),this.pageX=a.x,this.pageY=a.y,this.clientX=o.x,this.clientY=o.y,this.x0=t.startCoords.page.x-f.x,this.y0=t.startCoords.page.y-f.y,this.clientX0=t.startCoords.client.x-f.x,this.clientY0=t.startCoords.client.y-f.y,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.button=e.button,this.buttons=e.buttons,this.target=s,this.t0=t.downTimes[0],this.type=i+(r||""),this.interaction=t,this.interactable=h;var w=t.inertiaStatus;if(w.active&&(this.detail="inertia"),n&&(this.relatedTarget=n),E?"client"===u?(this.dx=o.x-t.startCoords.client.x,this.dy=o.y-t.startCoords.client.y):(this.dx=a.x-t.startCoords.page.x,this.dy=a.y-t.startCoords.page.y):y?(this.dx=0,this.dy=0):"inertiastart"===r?(this.dx=t.prevEvent.dx,this.dy=t.prevEvent.dy):"client"===u?(this.dx=o.x-t.prevEvent.clientX,this.dy=o.y-t.prevEvent.clientY):(this.dx=a.x-t.prevEvent.pageX,this.dy=a.y-t.prevEvent.pageY),t.prevEvent&&"inertia"===t.prevEvent.detail&&!w.active&&m[i].inertia&&m[i].inertia.zeroResumeDelta&&(w.resumeDx+=this.dx,w.resumeDy+=this.dy,this.dx=this.dy=0),"resize"===i&&t.resizeAxes?m.resize.square?("y"===t.resizeAxes?this.dx=this.dy:this.dy=this.dx,this.axes="xy"):(this.axes=t.resizeAxes,"x"===t.resizeAxes?this.dy=0:"y"===t.resizeAxes&&(this.dx=0)):"gesture"===i&&(this.touches=[c[0],c[1]],y?(this.distance=ft(c,u),this.box=mt(c),this.scale=1,this.ds=0,this.angle=yt(c,void 0,u),this.da=0):E||e instanceof Yt?(this.distance=t.prevEvent.distance,this.box=t.prevEvent.box,this.scale=t.prevEvent.scale,this.ds=this.scale-1,this.angle=t.prevEvent.angle,this.da=this.angle-t.gesture.startAngle):(this.distance=ft(c,u),this.box=mt(c),this.scale=this.distance/t.gesture.startDistance,this.angle=yt(c,t.gesture.prevAngle,u),this.ds=this.scale-t.gesture.prevScale,this.da=this.angle-t.gesture.prevAngle)),y)this.timeStamp=t.downTimes[0],this.dt=0,this.duration=0,this.speed=0,this.velocityX=0,this.velocityY=0;else if("inertiastart"===r)this.timeStamp=t.prevEvent.timeStamp,this.dt=t.prevEvent.dt,this.duration=t.prevEvent.duration,this.speed=t.prevEvent.speed,this.velocityX=t.prevEvent.velocityX,this.velocityY=t.prevEvent.velocityY;else if(this.timeStamp=(new Date).getTime(),this.dt=this.timeStamp-t.prevEvent.timeStamp,this.duration=this.timeStamp-t.downTimes[0],e instanceof Yt){var z=this[g]-t.prevEvent[g],D=this[v]-t.prevEvent[v],T=this.dt/1e3;this.speed=d(z,D)/T,this.velocityX=z/T,this.velocityY=D/T}else this.speed=t.pointerDelta[u].speed,this.velocityX=t.pointerDelta[u].vx,this.velocityY=t.pointerDelta[u].vy;if((E||"inertiastart"===r)&&t.prevEvent.speed>600&&this.timeStamp-t.prevEvent.timeStamp<150){var C=180*Math.atan2(t.prevEvent.velocityY,t.prevEvent.velocityX)/Math.PI;C<0&&(C+=360);var M=112.5<=C&&C<247.5,P=202.5<=C&&C<337.5,A=!M&&(292.5<=C||C<67.5),O=!P&&22.5<=C&&C<157.5;this.swipe={up:P,down:O,left:M,right:A,angle:C,speed:t.prevEvent.speed,velocity:{x:t.prevEvent.velocityX,y:t.prevEvent.velocityY}}}}function Rt(){this.originalEvent.preventDefault()}function It(t){var e="";if("drag"===t.name&&(e=C.drag),"resize"===t.name)if(t.axis)e=C[t.name+t.axis];else if(t.edges){for(var i="resize",r=["top","bottom","left","right"],s=0;s<4;s++)t.edges[r[s]]&&(i+=r[s]);e=C[i]}return e}function Ft(t,e,i,r,s,n,o){if(!e)return!1;if(!0===e){var a=J(n.width)?n.width:n.right-n.left,h=J(n.height)?n.height:n.bottom-n.top;if(a<0&&("left"===t?t="right":"right"===t&&(t="left")),h<0&&("top"===t?t="bottom":"bottom"===t&&(t="top")),"left"===t)return i.x<(a>=0?n.left:n.right)+o;if("top"===t)return i.y<(h>=0?n.top:n.bottom)+o;if("right"===t)return i.x>(a>=0?n.right:n.left)-o;if("bottom"===t)return i.y>(h>=0?n.bottom:n.top)-o}return!!$(r)&&($(e)?e===r:Jt(r,e,s))}function Nt(t,e,i){var r,s=this.getRect(i),n=!1,o=null,a=null,h=et({},e.curCoords.page),p=this.options;if(!s)return null;if(M.resize&&p.resize.enabled){var l=p.resize;if(r={left:!1,right:!1,top:!1,bottom:!1},B(l.edges)){for(var c in r)r[c]=Ft(c,l.edges[c],h,e._eventTarget,i,s,l.margin||w);r.left=r.left&&!r.right,r.top=r.top&&!r.bottom,n=r.left||r.right||r.top||r.bottom}else{var d="y"!==p.resize.axis&&h.x>s.right-w,u="x"!==p.resize.axis&&h.y>s.bottom-w;n=d||u,a=(d?"x":"")+(u?"y":"")}}return o=n?"resize":M.drag&&p.drag.enabled?"drag":null,M.gesture&&e.pointerIds.length>=2&&!e.dragging&&!e.resizing&&(o="gesture"),o?{name:o,axis:a,edges:r}:null}function qt(t,e){if(!B(t))return null;var i=t.name,r=e.options;return("resize"===i&&r.resize.enabled||"drag"===i&&r.drag.enabled||"gesture"===i&&r.gesture.enabled)&&M[i]?("resize"!==i&&"resizeyx"!==i||(i="resizexy"),t):null}function Ht(t,e){var i={},r=y[t.type],s=lt(t.path?t.path[0]:t.target),n=s;for(var o in e=!!e,t)i[o]=t[o];for(i.originalEvent=t,i.preventDefault=Rt;$(n);){for(var a=0;a<r.selectors.length;a++){var h=r.selectors[a],p=r.contexts[a];if(Kt(n,h)&&bt(p,s)&&bt(p,n)){var l=r.listeners[a];i.currentTarget=n;for(var c=0;c<l.length;c++)l[c][1]===e&&l[c][0](i)}}n=zt(n)}}function Wt(t){return Ht.call(this,t,!0)}function Ut(t,e){return v.get(t,e)||new Vt(t,e)}function Vt(t,i){var r;if(this._element=t,this._iEvents=this._iEvents||{},tt(t)){this.selector=t;var n=i&&i.context;r=n?ct(n):s,n&&(r.Node?n instanceof r.Node:$(n)||n===r.document)&&(this._context=n)}else r=ct(t),$(t)&&(b?(I.add(this._element,e.down,N.pointerDown),I.add(this._element,e.move,N.pointerHover)):(I.add(this._element,"mousedown",N.pointerDown),I.add(this._element,"mousemove",N.pointerHover),I.add(this._element,"touchstart",N.pointerDown),I.add(this._element,"touchmove",N.pointerHover)));this._doc=r.document,Bt(g,this._doc)||Lt(this._doc),v.push(this),this.set(i)}function $t(t,e){var i=!1;return function(){return i||(s.console.warn(e),i=!0),t.apply(this,arguments)}}function Gt(t){for(var e=0;e<m.length;e++)m[e].pointerEnd(t,t)}function Lt(t){if(!Bt(g,t)){var i=t.defaultView||t.parentWindow;for(var r in y)I.add(t,r,Ht),I.add(t,r,Wt,!0);b?(e=c===i.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"},I.add(t,e.down,N.selectorDown),I.add(t,e.move,N.pointerMove),I.add(t,e.over,N.pointerOver),I.add(t,e.out,N.pointerOut),I.add(t,e.up,N.pointerUp),I.add(t,e.cancel,N.pointerCancel),I.add(t,e.move,N.autoScrollMove)):(I.add(t,"mousedown",N.selectorDown),I.add(t,"mousemove",N.pointerMove),I.add(t,"mouseup",N.pointerUp),I.add(t,"mouseover",N.pointerOver),I.add(t,"mouseout",N.pointerOut),I.add(t,"touchstart",N.selectorDown),I.add(t,"touchmove",N.pointerMove),I.add(t,"touchend",N.pointerUp),I.add(t,"touchcancel",N.pointerCancel),I.add(t,"mousemove",N.autoScrollMove),I.add(t,"touchmove",N.autoScrollMove)),I.add(i,"blur",Gt);try{if(i.frameElement){var s=i.frameElement.ownerDocument,n=s.defaultView;I.add(s,"mouseup",N.pointerEnd),I.add(s,"touchend",N.pointerEnd),I.add(s,"touchcancel",N.pointerEnd),I.add(s,"pointerup",N.pointerEnd),I.add(s,"MSPointerUp",N.pointerEnd),I.add(n,"blur",Gt)}}catch(t){Ut.windowParentError=t}I.add(t,"dragstart",function(t){for(var e=0;e<m.length;e++){var i=m[e];if(i.element&&(i.element===t.target||bt(i.element,t.target)))return void i.checkAndPreventDefault(t,i.target,i.element)}}),I.useAttachEvent&&(I.add(t,"selectstart",function(t){var e=m[0];e.currentAction()&&e.checkAndPreventDefault(t)}),I.add(t,"dblclick",Xt("ie8Dblclick"))),g.push(t)}}function jt(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function Bt(t,e){return-1!==jt(t,e)}function Kt(e,r,n){return i?i(e,r,n):(s!==t&&(r=r.replace(/\/deep\//g," ")),e[X](r))}function Jt(t,e,i){for(;$(t);){if(Kt(t,e))return!0;if((t=zt(t))===i)return Kt(t,e)}return!1}}interactCustom(window);